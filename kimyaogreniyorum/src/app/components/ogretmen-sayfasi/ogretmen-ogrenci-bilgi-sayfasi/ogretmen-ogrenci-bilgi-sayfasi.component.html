<div class="container-fluid p-4">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Yükleniyor...</span>
    </div>
    <p class="mt-2 text-muted">Öğrenci bilgileri yükleniyor...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error }}
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !error && ogrenciBilgileri">
    <!-- Header Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm bg-gradient-primary text-white">
          <div class="card-body p-4">
            <div class="row align-items-center">
              <div class="col-md-8">
                <h2 class="mb-1 fw-bold">
                  <i class="bi bi-person-circle me-2"></i>
                  {{ ogrenciBilgileri.adi_soyadi }}
                </h2>
                <p class="mb-0 opacity-75">
                  {{ ogrenciBilgileri.okulu }} - {{ ogrenciBilgileri.sinifi }} | 
                  {{ ogrenciBilgileri.grubu }} Grubu
                </p>
              </div>
              <div class="col-md-4 text-end">
                <span class="badge bg-light text-dark fs-6 px-3 py-2">
                  {{ ogrenciBilgileri.ders_adi }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="text-success mb-2">
              <i class="bi bi-graph-up-arrow fs-1"></i>
            </div>
            <h5 class="fw-bold text-dark">{{ ortalamaPuan.toFixed(1) }}</h5>
            <p class="text-muted small mb-0">Ortalama Puan</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="text-primary mb-2">
              <i class="bi bi-currency-exchange fs-1"></i>
            </div>
            <h5 class="fw-bold text-dark">{{ formatCurrency(toplamOdenen) }}</h5>
            <p class="text-muted small mb-0">Toplam Ödenen</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="text-warning mb-2">
              <i class="bi bi-exclamation-triangle fs-1"></i>
            </div>
            <h5 class="fw-bold text-dark">{{ formatCurrency(kalanBorc) }}</h5>
            <p class="text-muted small mb-0">Kalan Borç</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="text-danger mb-2">
              <i class="bi bi-person-x fs-1"></i>
            </div>
            <h5 class="fw-bold text-dark">{{ devamsizlikSayisi }}</h5>
            <p class="text-muted small mb-0">Devamsızlık</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="row mb-4">
      <div class="col-12">
        <ul class="nav nav-pills nav-fill">
          <li class="nav-item">
            <button 
              class="nav-link" 
              [class.active]="activeTab === 'bilgiler'"
              (click)="setActiveTab('bilgiler')">
              <i class="bi bi-person-lines-fill me-2"></i>
              Öğrenci Bilgileri
            </button>
          </li>
          <li class="nav-item">
            <button 
              class="nav-link" 
              [class.active]="activeTab === 'sinavlar'"
              (click)="setActiveTab('sinavlar')">
              <i class="bi bi-graph-up me-2"></i>
              Sınav Sonuçları
            </button>
          </li>
          <li class="nav-item">
            <button 
              class="nav-link" 
              [class.active]="activeTab === 'konular'"
              (click)="setActiveTab('konular')">
              <i class="bi bi-pie-chart me-2"></i>
              Konu Analizleri
            </button>
          </li>
          <li class="nav-item">
            <button 
              class="nav-link" 
              [class.active]="activeTab === 'ucret'"
              (click)="setActiveTab('ucret')">
              <i class="bi bi-cash-coin me-2"></i>
              Ücret Bilgileri
            </button>
          </li>
          <li class="nav-item">
            <button 
              class="nav-link" 
              [class.active]="activeTab === 'devamsizlik'"
              (click)="setActiveTab('devamsizlik')">
              <i class="bi bi-calendar-check me-2"></i>
              Devamsızlık
            </button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Tab Contents -->
    <div class="row">
      <div class="col-12">

        <!-- Öğrenci Bilgileri Tab -->
        <div *ngIf="activeTab === 'bilgiler'" class="tab-content">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-person-lines-fill me-2 text-primary"></i>
                Öğrenci Detay Bilgileri
              </h5>
            </div>
            <div class="card-body p-4">
              <div class="row">
                <div class="col-md-6">
                  <h6 class="text-muted mb-3">Kişisel Bilgiler</h6>
                  <div class="mb-3">
                    <strong>Ad Soyad:</strong> {{ ogrenciBilgileri.adi_soyadi }}
                  </div>
                  <div class="mb-3">
                    <strong>E-posta:</strong> {{ ogrenciBilgileri.email }}
                  </div>
                  <div class="mb-3">
                    <strong>Telefon:</strong> {{ ogrenciBilgileri.cep_telefonu }}
                  </div>
                  <div class="mb-3">
                    <strong>Okul:</strong> {{ ogrenciBilgileri.okulu }}
                  </div>
                  <div class="mb-3">
                    <strong>Sınıf:</strong> {{ ogrenciBilgileri.sinifi }}
                  </div>
                </div>
                <div class="col-md-6">
                  <h6 class="text-muted mb-3">Ders Bilgileri</h6>
                  <div class="mb-3">
                    <strong>Grup:</strong> {{ ogrenciBilgileri.grubu }}
                  </div>
                  <div class="mb-3">
                    <strong>Ders Adı:</strong> {{ ogrenciBilgileri.ders_adi }}
                  </div>
                  <div class="mb-3">
                    <strong>Ders Günü:</strong> {{ ogrenciBilgileri.ders_gunu }}
                  </div>
                  <div class="mb-3">
                    <strong>Ders Saati:</strong> {{ ogrenciBilgileri.ders_saati }}
                  </div>
                  <div class="mb-3">
                    <strong>Aylık Ücret:</strong> {{ formatCurrency(ogrenciBilgileri.ucret) }}
                  </div>
                </div>
              </div>

              <hr class="my-4">

              <div class="row">
                <div class="col-md-6">
                  <h6 class="text-muted mb-3">Veli Bilgileri</h6>
                  <div class="mb-3">
                    <strong>Veli Adı:</strong> {{ ogrenciBilgileri.veli_adi || 'Belirtilmemiş' }}
                  </div>
                  <div class="mb-3">
                    <strong>Veli Telefonu:</strong> {{ ogrenciBilgileri.veli_cep || 'Belirtilmemiş' }}
                  </div>
                </div>
                <div class="col-md-6">
                  <h6 class="text-muted mb-3">Durum</h6>
                  <div class="mb-3">
                    <span class="badge" [class]="ogrenciBilgileri.aktif ? 'bg-success' : 'bg-danger'">
                      {{ ogrenciBilgileri.aktif ? 'Aktif' : 'Pasif' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sınav Sonuçları Tab -->
        <div *ngIf="activeTab === 'sinavlar'" class="tab-content">
          <div class="card mb-4" *ngIf="sinavSonuclari.length > 0">
            <div class="card-header">
              <h5><i class="bi bi-graph-up me-2"></i>Puan Gelişim Grafiği</h5>
            </div>
            <div class="card-body">
              <canvas #sinavChart width="800" height="400" style="max-width: 100%; height: 400px; border: 1px solid #ddd; border-radius: 8px;"></canvas>
            </div>
          </div>

          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-graph-up me-2 text-primary"></i>
                Sınav Sonuçları ve Grafik
              </h5>
            </div>
            <div class="card-body p-4">
              <!-- Sınav Listesi -->
              <div class="row">
                <div class="col-12">
                  <h6 class="mb-3">Sınav Detayları</h6>
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th>Sınav Adı</th>
                          <th>Tarih</th>
                          <th>Mini Grafik</th>
                          <th>Doğru</th>
                          <th>Yanlış</th>
                          <th>Boş</th>
                          <th>Puan</th>
                          <th>Başarı %</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let sinav of sinavSonuclari; let i = index">
                          <td class="fw-medium">{{ sinav.sinav_adi }}</td>
                          <td>{{ formatTarih(sinav.tarih) }}</td>
                          <td>
                            <!-- Mini Chart -->
                            <div class="mini-chart-container" style="width: 60px; height: 60px;">
                              <canvas [id]="'miniChart-' + i" width="60" height="60"></canvas>
                            </div>
                          </td>
                          <td>
                            <span class="badge bg-success">{{ sinav.net_dogru }}</span>
                          </td>
                          <td>
                            <span class="badge bg-danger">{{ sinav.net_yanlis }}</span>
                          </td>
                          <td>
                            <span class="badge bg-secondary">{{ sinav.net_bos }}</span>
                          </td>
                          <td class="fw-bold">{{ sinav.puan }}</td>
                          <td>
                            <div class="exam-success-rate">
                              <div class="success-percentage">{{ getSuccessPercentage(sinav) }}%</div>
                              <div class="progress" style="width: 80px; height: 8px;">
                                <div 
                                  class="progress-bar" 
                                  [class]="getProgressBarClass(getSuccessPercentage(sinav))"
                                  [style.width.%]="getSuccessPercentage(sinav)">
                                </div>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div *ngIf="sinavSonuclari.length === 0" class="text-center py-4">
                <i class="bi bi-graph-down fs-1 text-muted"></i>
                <p class="text-muted mt-2">Henüz sınav sonucu bulunmuyor.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Konu Analizleri Tab -->
        <div *ngIf="activeTab === 'konular'" class="tab-content">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-pie-chart me-2 text-primary"></i>
                Konu Bazında Analiz
              </h5>
            </div>
            <div class="card-body p-4">
              <div class="row">
                <div class="col-12">
                  <!-- Konu Analizleri Tablosu -->
                  <div *ngIf="activeTab === 'konular'" class="table-responsive">
                    <div *ngIf="konuAnalizleri && konuAnalizleri.length > 0; else noKonuData">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Konu Adı</th>
                            <th class="text-center">Toplam Soru</th>
                            <th class="text-center">Doğru</th>
                            <th class="text-center">Yanlış</th>
                            <th class="text-center">Boş</th>
                            <th class="text-center">Başarı Oranı</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let konu of konuAnalizleri; trackBy: trackByKonuAdi">
                            <td>{{ konu.konu_adi }}</td>
                            <td class="text-center">{{ konu.toplam_soru }}</td>
                            <td class="text-center text-success">{{ konu.dogru_sayisi }}</td>
                            <td class="text-center text-danger">{{ konu.yanlis_sayisi }}</td>
                            <td class="text-center text-warning">{{ konu.bos_sayisi }}</td>
                            <td class="text-center">
                              <div class="d-flex align-items-center">
                                <div class="progress flex-grow-1 me-2" style="height: 20px;">
                                  <div 
                                    class="progress-bar" 
                                    [class]="getProgressBarClass(konu.basari_orani)"
                                    [style.width.%]="konu.basari_orani">
                                    {{ konu.basari_orani | number:'1.1-1' }}%
                                  </div>
                                </div>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <ng-template #noKonuData>
                      <div class="text-center py-4">
                        <p class="text-muted">Henüz konu analizi verisi bulunmuyor.</p>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ücret Bilgileri Tab -->
        <div *ngIf="activeTab === 'ucret'" class="tab-content">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-cash-coin me-2 text-primary"></i>
                Ücret ve Ödeme Bilgileri
              </h5>
            </div>
            <div class="card-body p-4">
              <!-- Ödeme Özeti -->
              <div class="row mb-4">
                <div class="col-md-4">
                  <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                      <h4 class="fw-bold">{{ formatCurrency(toplamOdenen) }}</h4>
                      <p class="mb-0">Toplam Ödenen</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card bg-warning text-white">
                    <div class="card-body text-center">
                      <h4 class="fw-bold">₺{{ kalanBorc }}</h4>
                      <p class="mb-0">Kalan Borç</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card bg-info text-white">
                    <div class="card-body text-center">
                      <h4 class="fw-bold">{{ formatCurrency(ogrenciBilgileri.ucret) }}</h4>
                      <p class="mb-0">Aylık Ücret</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Ödeme Geçmişi -->
              <div class="row">
                <div class="col-12">
                  <h6 class="mb-3">Ödeme Geçmişi</h6>
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th>Tarih</th>
                          <th>Tutar</th>
                          <th>Açıklama</th>
                          <th>Ay/Yıl</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let odeme of odemeBilgileri">
                          <td>{{ formatTarih(odeme.odeme_tarihi) }}</td>
                          <td class="fw-bold text-success">{{ formatCurrency(odeme.tutar) }}</td>
                          <td>{{ odeme.aciklama || 'Aylık ödeme' }}</td>
                          <td>{{ odeme.ay }}/{{ odeme.yil }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <!-- Devamsızlık Bilgileri -->
              <div class="row mt-4">
                <div class="col-12">
                  <h6 class="mb-3">Devamsızlık Kayıtları</h6>
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th>Tarih</th>
                          <th>Durum</th>
                          <th>Açıklama</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let kayit of devamsizlikKayitlari">
                          <td>{{ formatTarih(kayit.tarih) }}</td>
                          <td>
                            <span class="badge" [class]="kayit.durum === 'present' ? 'bg-success' : 'bg-danger'">
                              {{ kayit.durum === 'present' ? 'Var' : 'Yok' }}
                            </span>
                          </td>
                          <td>{{ kayit.aciklama || kayit.grup || '-' }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div *ngIf="odemeBilgileri.length === 0 && devamsizlikKayitlari.length === 0" class="text-center py-4">
                <i class="bi bi-cash-coin fs-1 text-muted"></i>
                <p class="text-muted mt-2">Henüz ödeme veya devamsızlık kaydı bulunmuyor.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Devamsızlık/Katılım Bilgileri Sekmesi -->
        <div *ngIf="activeTab === 'devamsizlik'" class="tab-content">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-calendar-check me-2 text-primary"></i>
                Devamsızlık ve Katılım Analizi
              </h5>
            </div>
            <div class="card-body p-4">
              <!-- Katılım İstatistikleri -->
              <div class="attendance-stats-grid mb-4" *ngIf="getStudentAttendanceStats() as stats">
                <!-- Katıldığı Dersler -->
                <div class="stats-card present-lessons">
                  <div class="card-icon">
                    <i class="bi bi-check-circle-fill"></i>
                  </div>
                  <div class="card-content">
                    <h3 class="main-number">{{ stats.presentCount }}</h3>
                    <p class="card-title">Katıldığı Ders</p>
                    <div class="lesson-breakdown">
                      <div class="breakdown-item">
                        <span class="label">Normal:</span>
                        <span class="value">{{ getAttendanceByType('normal', 'present') }}</span>
                      </div>
                      <div class="breakdown-item">
                        <span class="label">Ek Ders:</span>
                        <span class="value">{{ getAttendanceByType('ek_ders', 'present') }}</span>
                      </div>
                      <div class="breakdown-item">
                        <span class="label">Etüt:</span>
                        <span class="value">{{ getAttendanceByType('etut_dersi', 'present') }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Devamsızlık -->
                <div class="stats-card absent-lessons">
                  <div class="card-icon">
                    <i class="bi bi-x-circle-fill"></i>
                  </div>
                  <div class="card-content">
                    <h3 class="main-number">{{ stats.absentCount }}</h3>
                    <p class="card-title">Devamsızlık</p>
                    <div class="lesson-breakdown">
                      <div class="breakdown-item">
                        <span class="label">Normal:</span>
                        <span class="value">{{ getAttendanceByType('normal', 'absent') }}</span>
                      </div>
                      <div class="breakdown-item">
                        <span class="label">Ek Ders:</span>
                        <span class="value">{{ getAttendanceByType('ek_ders', 'absent') }}</span>
                      </div>
                      <div class="breakdown-item">
                        <span class="label">Etüt:</span>
                        <span class="value">{{ getAttendanceByType('etut_dersi', 'absent') }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Katılım Oranı -->
                <div class="stats-card attendance-rate">
                  <div class="card-icon">
                    <i class="bi bi-graph-up"></i>
                  </div>
                  <div class="card-content">
                    <h3 class="main-number">{{ stats.attendancePercentage }}%</h3>
                    <p class="card-title">Katılım Oranı</p>
                    <div class="progress-bar">
                      <div class="progress-fill" [style.width.%]="stats.attendancePercentage"></div>
                    </div>
                    <div class="lesson-breakdown">
                      <div class="breakdown-item">
                        <span class="label">Toplam Kayıt:</span>
                        <span class="value">{{ stats.totalRecords }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Ders Tipi Dağılımı -->
                <div class="stats-card lesson-types">
                  <div class="card-icon">
                    <i class="bi bi-pie-chart-fill"></i>
                  </div>
                  <div class="card-content">
                    <h3 class="main-number">{{ stats.totalRecords }}</h3>
                    <p class="card-title">Toplam Ders</p>
                    <div class="lesson-breakdown">
                      <div class="breakdown-item">
                        <span class="label">Normal:</span>
                        <span class="value">{{ getTotalByType('normal') }}</span>
                      </div>
                      <div class="breakdown-item">
                        <span class="label">Ek Ders:</span>
                        <span class="value">{{ getTotalByType('ek_ders') }}</span>
                      </div>
                      <div class="breakdown-item">
                        <span class="label">Etüt:</span>
                        <span class="value">{{ getTotalByType('etut_dersi') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Son Katılım Kayıtları -->
              <div class="mt-4">
                <h6 class="fw-bold mb-3">Son Katılım Kayıtları ({{ historicalAttendance.length }} toplam kayıt)</h6>
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Tarih</th>
                        <th>Durum</th>
                        <th>Ders Tipi</th>
                        <th>Grup</th>
                        <th>Saat</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let kayit of historicalAttendance | slice:0:15">
                        <td>{{ formatTarih(kayit.tarih) }}</td>
                        <td>
                          <span class="badge" 
                                [class.bg-success]="kayit.durum === 'present'"
                                [class.bg-danger]="kayit.durum === 'absent'">
                            {{ kayit.durum === 'present' ? 'Katıldı' : 'Katılmadı' }}
                          </span>
                        </td>
                        <td>
                          <span class="badge bg-info">{{ getLessonTypeText(kayit.ders_tipi) }}</span>
                        </td>
                        <td>{{ kayit.grup || '-' }}</td>
                        <td>{{ kayit.zaman ? formatTime(kayit.zaman) : '-' }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <ng-template #noDataTemplate>
                <div class="alert alert-info text-center">
                  <i class="bi bi-info-circle me-2"></i>
                  Bu öğrenci için henüz devamsızlık kaydı bulunmuyor.
                </div>
              </ng-template>
                </div>
              </div>

              <div *ngIf="getRecentAttendanceRecords().length === 0" class="text-center py-4">
                <i class="bi bi-calendar-x fs-1 text-muted"></i>
                <p class="text-muted mt-2">Henüz katılım kaydı bulunmuyor.</p>
              </div>
            </div>
          </div>
        </div>


        <!-- Ücret Analizi Sekmesi -->
        <div *ngIf="activeTab === 'ucret-analizi'" class="tab-content">
          <div class="payment-analysis-section">
            <div class="section-header">
              <h3><i class="bi bi-graph-up"></i> Öğrenci Ücret Analizi</h3>
              <p class="section-description">Ders tiplerine göre ücret durumu ve ödeme analizi</p>
            </div>

            <div class="analysis-table-container">
              <table class="analysis-table">
                <thead>
                  <tr>
                    <th>Öğrenci</th>
                    <th>Ders Ücreti</th>
                    <th colspan="4">Katıldığı Dersler</th>
                    <th>Beklenen Ödeme</th>
                    <th>Yapılan Ödeme</th>
                    <th>Kalan Borç</th>
                    <th>Ödeme Oranı</th>
                  </tr>
                  <tr class="sub-header">
                    <th></th>
                    <th></th>
                    <th>Toplam</th>
                    <th>Normal Ders</th>
                    <th>Ek Ders</th>
                    <th>Dönem Sayısı</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let analysis of getPaymentAnalysisData()" class="student-row">
                    <td class="student-info">
                      <img [src]="ogrenciBilgileri.avatar || getDefaultAvatar(ogrenciBilgileri.adi_soyadi || 'Student')" 
                           class="student-avatar-small" 
                           alt="Avatar">
                      <div class="student-details">
                        <span class="student-name">{{ analysis.studentName }}</span>
                        <span class="student-email">{{ analysis.studentEmail }}</span>
                      </div>
                    </td>
                    <td class="lesson-fee">
                      <span class="fee-badge">{{ formatCurrency(analysis.lessonFee) }}</span>
                    </td>
                    <td class="total-lessons">{{ analysis.lessons.total }}</td>
                    <td class="normal-lessons">{{ analysis.lessons.normal }}</td>
                    <td class="ek-lessons">{{ analysis.lessons.ek_ders }}</td>
                    <td class="payment-cycles">{{ analysis.paymentCycles }}</td>
                    <td class="expected-payment">
                      <span class="amount-badge expected">{{ formatCurrency(analysis.expectedAmount) }}</span>
                    </td>
                    <td class="paid-amount">
                      <span class="amount-badge paid">{{ formatCurrency(analysis.paidAmount) }}</span>
                    </td>
                    <td class="debt-amount">
                      <span class="amount-badge debt" [class.positive]="analysis.debt > 0" [class.zero]="analysis.debt === 0">
                        {{ formatCurrency(Math.abs(analysis.debt)) }}
                      </span>
                    </td>
                    <td class="payment-percentage">
                      <div class="percentage-badge" 
                           [class.excellent]="analysis.paymentPercentage >= 100"
                           [class.good]="analysis.paymentPercentage >= 80 && analysis.paymentPercentage < 100"
                           [class.average]="analysis.paymentPercentage >= 60 && analysis.paymentPercentage < 80"
                           [class.poor]="analysis.paymentPercentage < 60">
                        {{ analysis.paymentPercentage }}%
                      </div>
                      <div class="progress-bar-container">
                        <div class="progress-bar" 
                             [style.width.%]="Math.min(analysis.paymentPercentage, 100)"
                             [class.excellent]="analysis.paymentPercentage >= 100"
                             [class.good]="analysis.paymentPercentage >= 80 && analysis.paymentPercentage < 100"
                             [class.average]="analysis.paymentPercentage >= 60 && analysis.paymentPercentage < 80"
                             [class.poor]="analysis.paymentPercentage < 60">
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Ödeme Özeti -->
            <div class="payment-summary mt-4">
              <div class="row">
                <div class="col-md-3">
                  <div class="summary-card">
                    <div class="summary-icon">
                      <i class="bi bi-calendar-check text-success"></i>
                    </div>
                    <div class="summary-content">
                      <h4>{{ getPaymentSummary().totalAttendedLessons }}</h4>
                      <p>Toplam Katıldığı Ders</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="summary-card">
                    <div class="summary-icon">
                      <i class="bi bi-cash-stack text-info"></i>
                    </div>
                    <div class="summary-content">
                      <h4>{{ formatCurrency(getPaymentSummary().totalExpectedAmount) }}</h4>
                      <p>Beklenen Toplam Ödeme</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="summary-card">
                    <div class="summary-icon">
                      <i class="bi bi-check-circle text-success"></i>
                    </div>
                    <div class="summary-content">
                      <h4>{{ formatCurrency(getPaymentSummary().totalPaidAmount) }}</h4>
                      <p>Yapılan Toplam Ödeme</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="summary-card">
                    <div class="summary-icon">
                      <i class="bi bi-exclamation-triangle" [class.text-danger]="getPaymentSummary().totalDebt > 0" [class.text-success]="getPaymentSummary().totalDebt === 0"></i>
                    </div>
                    <div class="summary-content">
                      <h4 [class.text-danger]="getPaymentSummary().totalDebt > 0" [class.text-success]="getPaymentSummary().totalDebt === 0">
                        {{ formatCurrency(Math.abs(getPaymentSummary().totalDebt)) }}
                      </h4>
                      <p>{{ getPaymentSummary().totalDebt > 0 ? 'Kalan Borç' : 'Fazla Ödeme' }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        
      </div>
    </div>
