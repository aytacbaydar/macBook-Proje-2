<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
      <div class="position-sticky pt-3">
        <div class="sidebar-header mb-4">
          <h5 class="fw-bold text-primary">Öğretmen Paneli</h5>
        </div>

        <div class="sidebar-menu">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link active" href="#">
                <i class="bi bi-house"></i>
                Ana Sayfa
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" routerLink="/ogretmen-sayfasi/ders-anlatma-tahtasi">
                <i class="bi bi-easel"></i>
                Ders Anlatım Tahtası
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" (click)="logout()">
                <i class="bi bi-box-arrow-right"></i>
                Çıkış Yap
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Öğretmen Dashboard</h1>
      </div>

      <!-- Dashboard Stats -->
      <div class="row mb-4">
        <div class="col-md-6 col-lg-3 mb-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title mb-1">Toplam Öğrencim</h6>
                  <h3 class="mb-0">{{ totalCount }}</h3>
                </div>
                <i class="bi bi-people fs-1"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title mb-1">Aktif Öğrenci</h6>
                  <h3 class="mb-0">{{ students.filter(s => s.aktif).length }}</h3>
                </div>
                <i class="bi bi-person-check fs-1"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title mb-1">Pasif Öğrenci</h6>
                  <h3 class="mb-0">{{ students.filter(s => !s.aktif).length }}</h3>
                </div>
                <i class="bi bi-person-x fs-1"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title mb-1">Bu Ay Kayıt</h6>
                  <h3 class="mb-0">{{ students.filter(s => new Date(s.created_at).getMonth() === new Date().getMonth()).length }}</h3>
                </div>
                <i class="bi bi-calendar-plus fs-1"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Student List -->
      <div class="card shadow-sm">
        <div class="card-header bg-white">
          <div class="d-flex justify-content-between align-items-center flex-wrap">
            <h5 class="mb-0">Öğrencilerim</h5>
            <span class="badge bg-primary">{{ totalStudentCount }} öğrenci</span>
          </div>

          <!-- Filters -->
          <div class="row g-2 mt-2">
            <div class="col-md-4">
              <div class="input-group input-group-sm">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" 
                       class="form-control" 
                       placeholder="Ad, email veya telefon ile ara..."
                       [(ngModel)]="searchTerm"
                       (input)="onSearchChange()">
              </div>
            </div>
            <div class="col-md-2">
              <select class="form-select form-select-sm" 
                      [(ngModel)]="selectedGroup" 
                      (change)="onGroupChange()">
                <option value="">Tüm Gruplar</option>
                <option *ngFor="let group of groups" [value]="group">{{ group }}</option>
              </select>
            </div>
            <div class="col-md-2">
              <select class="form-select form-select-sm" 
                      [(ngModel)]="selectedGrade" 
                      (change)="onGradeChange()">
                <option value="">Tüm Sınıflar</option>
                <option *ngFor="let grade of grades" [value]="grade">{{ grade }}</option>
              </select>
            </div>
            <div class="col-md-2">
              <select class="form-select form-select-sm" 
                      [(ngModel)]="selectedStatus" 
                      (change)="onStatusChange()">
                <option value="">Tüm Durumlar</option>
                <option value="aktif">Aktif</option>
                <option value="pasif">Pasif</option>
              </select>
            </div>
            <div class="col-md-2">
              <button class="btn btn-outline-secondary btn-sm w-100" (click)="clearFilters()">
                <i class="bi bi-x-circle me-1"></i>Temizle
              </button>
            </div>
          </div>
        </div>

        <div class="card-body">
          <!-- Loading State -->
          <div *ngIf="loading" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Yükleniyor...</span>
            </div>
            <p class="mt-2 text-muted">Öğrenciler yükleniyor...</p>
          </div>

          <!-- Error State -->
          <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            {{ error }}
            <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadMyStudents()">
              Tekrar Dene
            </button>
          </div>

          <!-- Students Table -->
          <div *ngIf="!loading && !error">
            <!-- Desktop Table -->
            <div class="d-none d-md-block">
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>Ad Soyad</th>
                      <th>Email</th>
                      <th>Telefon</th>
                      <th>Sınıf</th>
                      <th>Grup</th>
                      <th>Ders Bilgileri</th>
                      <th>Durum</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let student of paginatedStudents">
                      <td>
                        <div class="d-flex align-items-center">
                          <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-2" 
                               style="width: 35px; height: 35px; font-size: 12px;">
                            {{ student.adi_soyadi?.charAt(0) || 'Ö' }}
                          </div>
                          <div>
                            <div class="fw-medium">{{ student.adi_soyadi }}</div>
                            <div class="small text-muted" *ngIf="student.okulu">{{ student.okulu }}</div>
                          </div>
                        </div>
                      </td>
                      <td>{{ student.email }}</td>
                      <td>{{ student.cep_telefonu || '-' }}</td>
                      <td>{{ student.sinifi || '-' }}</td>
                      <td>{{ student.grubu || '-' }}</td>
                      <td>
                        <div class="small">
                          <div *ngIf="student.ders_gunu">
                            <i class="bi bi-calendar-week me-1"></i>{{ student.ders_gunu }}
                          </div>
                          <div *ngIf="student.ders_saati">
                            <i class="bi bi-clock me-1"></i>{{ student.ders_saati }}
                          </div>
                          <div *ngIf="student.ucret" class="text-success">
                            <i class="bi bi-currency-dollar me-1"></i>{{ student.ucret }}₺
                          </div>
                        </div>
                      </td>
                      <td>
                        <span class="badge" 
                              [class.bg-success]="student.aktif" 
                              [class.bg-secondary]="!student.aktif">
                          {{ student.aktif ? 'Aktif' : 'Pasif' }}
                        </span>
                      </td>
                    </tr>
                    <tr *ngIf="paginatedStudents.length === 0">
                      <td colspan="7" class="text-center py-4 text-muted">
                        <div class="d-flex flex-column align-items-center">
                          <div class="bg-light rounded-circle p-3 mb-2">
                            <i class="bi bi-mortarboard fs-5 text-muted"></i>
                          </div>
                          <p>{{ filteredStudents.length === 0 && students.length > 0 ? 'Arama kriterlerine uygun öğrenci bulunamadı.' : 'Henüz size atanmış öğrenci bulunmuyor.' }}</p>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Mobile Cards -->
            <div class="d-md-none">
              <div *ngFor="let student of paginatedStudents" class="card mb-2 shadow-sm border-start border-primary border-3">
                <div class="card-body p-3">
                  <div class="d-flex align-items-start">
                    <div class="flex-shrink-0 me-3">
                      <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" 
                           style="width: 40px; height: 40px; font-size: 14px;">
                        {{ student.adi_soyadi?.charAt(0) || 'Ö' }}
                      </div>
                    </div>

                    <div class="flex-grow-1">
                      <div class="d-flex justify-content-between align-items-start">
                        <div>
                          <h6 class="card-title mb-1">{{ student.adi_soyadi }}</h6>
                          <p class="card-text small text-muted mb-1">{{ student.email }}</p>
                        </div>
                        <span class="badge" 
                              [class.bg-success]="student.aktif" 
                              [class.bg-secondary]="!student.aktif">
                          {{ student.aktif ? 'Aktif' : 'Pasif' }}
                        </span>
                      </div>

                      <div class="row g-2 small">
                        <div class="col-6">
                          <div class="text-muted mb-1">Sınıf</div>
                          <div>{{ student.sinifi || 'Belirtilmemiş' }}</div>
                        </div>
                        <div class="col-6">
                          <div class="text-muted mb-1">Grup</div>
                          <div>{{ student.grubu || 'Belirtilmemiş' }}</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="student.ders_gunu || student.ders_saati || student.ucret" class="mt-2 p-2 bg-info-subtle rounded">
                    <div class="small">
                      <div *ngIf="student.ders_gunu"><strong>Ders Günü:</strong> {{ student.ders_gunu }}</div>
                      <div *ngIf="student.ders_saati"><strong>Ders Saati:</strong> {{ student.ders_saati }}</div>
                      <div *ngIf="student.ucret"><strong>Ücret:</strong> {{ student.ucret }}₺</div>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="paginatedStudents.length === 0" class="card shadow-sm text-center p-4 text-muted">
                <div class="d-flex flex-column align-items-center">
                  <div class="bg-light rounded-circle p-3 mb-2">
                    <i class="bi bi-mortarboard fs-5 text-muted"></i>
                  </div>
                  <p>{{ filteredStudents.length === 0 && students.length > 0 ? 'Arama kriterlerine uygun öğrenci bulunamadı.' : 'Henüz size atanmış öğrenci bulunmuyor.' }}</p>
                </div>
              </div>
            </div>

            <!-- Pagination -->
            <div *ngIf="totalStudentCount > 0" class="mt-3">
              <div class="d-flex justify-content-between align-items-center">
                <div class="text-muted small">
                  Toplam <span class="fw-medium">{{ totalStudentCount }}</span> öğrenci, 
                  <span class="fw-medium">{{ (currentStudentPage - 1) * itemsPerPage + 1 }}-{{ Math.min((currentStudentPage * itemsPerPage), totalStudentCount) }}</span> arası gösteriliyor

                  <div class="d-inline-block ms-3">
                    <span class="text-muted small me-2">Göster:</span>
                    <select class="form-select form-select-sm d-inline-block w-auto" 
                            [(ngModel)]="itemsPerPage" 
                            (change)="setStudentPage(1)">
                      <option [value]="5">5</option>
                      <option [value]="10">10</option>
                      <option [value]="15">15</option>
                    </select>
                  </div>
                </div>
                <nav aria-label="Page navigation">
                  <ul class="pagination pagination-sm mb-0">
                    <li class="page-item" [class.disabled]="currentStudentPage === 1">
                      <button class="page-link" (click)="setStudentPage(currentStudentPage - 1)" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                      </button>
                    </li>
                    <li class="page-item" *ngFor="let page of getStudentPageArray()" [class.active]="currentStudentPage === page">
                      <button class="page-link" (click)="setStudentPage(page)">{{ page }}</button>
                    </li>
                    <li class="page-item" [class.disabled]="currentStudentPage === getStudentTotalPages()">
                      <button class="page-link" (click)="setStudentPage(currentStudentPage + 1)" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                      </button>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>