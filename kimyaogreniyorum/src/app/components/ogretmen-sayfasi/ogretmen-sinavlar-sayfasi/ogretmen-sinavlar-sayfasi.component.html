<div class="modern-container">
  <!-- Header Section -->
  <div class="modern-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">Cevap Anahtarı Yönetimi</h1>
        <p class="page-subtitle">Sınav cevap anahtarlarınızı kolayca yönetin ve düzenleyin</p>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-number">{{ cevapAnahtarlari.length }}</div>
          <div class="stat-label">Toplam Sınav</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Alert Messages -->
  <div class="alerts-container">
    <div *ngIf="successMessage" class="modern-alert success">
      <div class="alert-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="alert-content">{{ successMessage }}</div>
      <button class="alert-close" (click)="successMessage = ''">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div *ngIf="errorMessage" class="modern-alert error">
      <div class="alert-icon">
        <i class="fas fa-exclamation-circle"></i>
      </div>
      <div class="alert-content">{{ errorMessage }}</div>
      <button class="alert-close" (click)="errorMessage = ''">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-layout">

    <!-- Form Panel -->
    <div class="modern-panel form-panel">
      <div class="panel-header">
        <h2 class="panel-title">
          <i class="fas fa-plus-circle"></i>
          Yeni Cevap Anahtarı Ekle
        </h2>
      </div>

      <form (ngSubmit)="submitForm()" class="modern-form">
        <!-- Basic Info Section -->
        <div class="form-section">
          <h3 class="section-title">Temel Bilgiler</h3>
          <div class="form-grid">
            <div class="form-field">
              <label class="field-label">
                <i class="fas fa-file-alt"></i>
                Sınav Adı
              </label>
              <input 
                type="text" 
                class="modern-input"
                [(ngModel)]="cevapAnahtari.sinav_adi"
                name="sinav_adi"
                placeholder="Örn: TYT-AYT Kimya Sınavı"
                required
              >
            </div>

            <div class="form-field">
              <label class="field-label">
                <i class="fas fa-tag"></i>
                Sınav Türü
              </label>
              <select 
                class="modern-select"
                [(ngModel)]="cevapAnahtari.sinav_turu"
                name="sinav_turu"
                required
              >
                <option value="">Sınav türünü seçin</option>
                <option *ngFor="let tur of sinavTurleri" [value]="tur.id">{{ tur.label }}</option>
              </select>
            </div>

            <div class="form-field">
              <label class="field-label">
                <i class="fas fa-list-ol"></i>
                Soru Sayısı
              </label>
              <input 
                type="number" 
                class="modern-input"
                [(ngModel)]="cevapAnahtari.soru_sayisi"
                (ngModelChange)="updateSorular($event)"
                name="soru_sayisi"
                min="1" 
                [max]="maxSoruSayisi"
                required
              >
            </div>

            <div class="form-field">
              <label class="field-label">
                <i class="fas fa-calendar"></i>
                Sınav Tarihi
              </label>
              <input 
                type="date" 
                class="modern-input"
                [(ngModel)]="cevapAnahtari.tarih"
                name="tarih"
                required
              >
            </div>
          </div>
        </div>

        <!-- File Upload Section -->
        <div class="form-section">
          <h3 class="section-title">Sınav Kapağı</h3>
          <div class="upload-area" [class.has-file]="imagePreview">
            <input 
              type="file" 
              id="sinav_kapagi"
              accept="image/*" 
              (change)="onImageSelected($event)"
              class="file-input"
            >
            <label for="sinav_kapagi" class="upload-label">
              <div class="upload-content" *ngIf="!imagePreview">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Dosya yüklemek için tıklayın</span>
                <small>PNG, JPG, JPEG (Max: 5MB)</small>
              </div>
              <div class="image-preview" *ngIf="imagePreview">
                <img [src]="imagePreview" alt="Önizleme">
                <div class="image-overlay">
                  <i class="fas fa-edit"></i>
                  <span>Değiştir</span>
                </div>
              </div>
            </label>
          </div>
        </div>

        <!-- Answers Section -->
        <div class="form-section" *ngIf="sorular.length > 0">
          <h3 class="section-title">Cevap Anahtarı</h3>
          <div class="answers-grid">
            <div class="answer-item" *ngFor="let soru of sorular; let i = index">
              <div class="question-number">{{ i + 1 }}</div>
              <div class="answer-inputs">
                <input 
                  type="text" 
                  class="answer-input"
                  [(ngModel)]="cevapAnahtari.cevaplar['ca' + (i + 1)]"
                  [name]="'ca' + (i + 1)"
                  maxlength="1" 
                  placeholder="A"
                  required
                >
                <input 
                  type="text" 
                  class="topic-input"
                  [(ngModel)]="cevapAnahtari.konular['ka' + (i + 1)]"
                  [name]="'ka' + (i + 1)"
                  placeholder="Konu"
                >
                <input 
                  type="text" 
                  class="video-input"
                  [(ngModel)]="cevapAnahtari.videolar['va' + (i + 1)]"
                  [name]="'va' + (i + 1)"
                  placeholder="Video URL"
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="modern-btn secondary" (click)="initModel()">
            <i class="fas fa-undo"></i>
            Sıfırla
          </button>
          <button type="submit" class="modern-btn primary" [disabled]="submitting">
            <i class="fas fa-save"></i>
            {{ submitting ? 'Kaydediliyor...' : 'Kaydet' }}
          </button>
        </div>
      </form>
    </div>

    <!-- List Panel -->
    <div class="modern-panel list-panel">
      <div class="panel-header">
        <h2 class="panel-title">
          <i class="fas fa-list"></i>
          Cevap Anahtarları
        </h2>
      </div>

      <div class="list-container">
        <!-- Loading State -->
        <div class="loading-state" *ngIf="loading">
          <div class="spinner"></div>
          <p>Veriler yükleniyor...</p>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="!loading && cevapAnahtarlari.length === 0">
          <div class="empty-icon">
            <i class="fas fa-inbox"></i>
          </div>
          <h3>Henüz cevap anahtarı yok</h3>
          <p>İlk cevap anahtarınızı oluşturmak için formu kullanın</p>
        </div>

        <!-- Items List -->
        <div class="items-grid" *ngIf="!loading && cevapAnahtarlari.length > 0">
          <div class="item-card" *ngFor="let cevap of cevapAnahtarlari">
            <div class="card-header">
              <div class="card-info">
                <h3 class="card-title">{{ cevap.sinav_adi }}</h3>
                <span class="card-badge">{{ getSinavTuruLabel(cevap.sinav_turu) }}</span>
              </div>
              <div class="card-actions">
                <button class="action-btn edit" (click)="editCevapAnahtari(cevap)" title="Düzenle">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" (click)="cevap.id && deleteCevapAnahtari(cevap.id)" title="Sil">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>

            <div class="card-body">
              <div class="card-stats">
                <div class="stat-item">
                  <i class="fas fa-list-ol"></i>
                  <span>{{ cevap.soru_sayisi }} Soru</span>
                </div>
                <div class="stat-item">
                  <i class="fas fa-calendar"></i>
                  <span>{{ cevap.tarih }}</span>
                </div>
              </div>

              <div class="card-preview" *ngIf="cevap.sinav_kapagi">
                <img [src]="'/uploads/' + cevap.sinav_kapagi" alt="Sınav Kapağı" class="preview-image">
              </div>

              <div class="answers-preview" *ngIf="cevap.cevaplar">
                <h4>Cevap Anahtarı Önizleme</h4>
                <div class="answers-grid-mini">
                  <div class="answer-preview" *ngFor="let i of getSoruDizisi(cevap); let idx = index">
                    <span class="q-num">{{ idx + 1 }}</span>
                    <span class="q-answer">{{ cevap.cevaplar['ca' + (idx + 1)] || '-' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modern-modal" [class.active]="editMode">
    <div class="modal-backdrop" (click)="cancelEdit()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Cevap Anahtarı Düzenle</h3>
        <button class="modal-close" (click)="cancelEdit()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body" *ngIf="currentEditingCevapAnahtari">
        <form (ngSubmit)="submitEditForm()" class="modern-form">
          <!-- Same form structure as above but with edit data -->
          <div class="form-section">
            <h3 class="section-title">Temel Bilgiler</h3>
            <div class="form-grid">
              <div class="form-field">
                <label class="field-label">Sınav Adı</label>
                <input 
                  type="text" 
                  class="modern-input"
                  [(ngModel)]="currentEditingCevapAnahtari.sinav_adi"
                  name="edit_sinav_adi"
                  required
                >
              </div>

              <div class="form-field">
                <label class="field-label">Sınav Türü</label>
                <select 
                  class="modern-select"
                  [(ngModel)]="currentEditingCevapAnahtari.sinav_turu"
                  name="edit_sinav_turu"
                  required
                >
                  <option value="">Sınav türünü seçin</option>
                  <option *ngFor="let tur of sinavTurleri" [value]="tur.id">{{ tur.label }}</option>
                </select>
              </div>

              <div class="form-field">
                <label class="field-label">Soru Sayısı</label>
                <input 
                  type="number" 
                  class="modern-input"
                  [(ngModel)]="currentEditingCevapAnahtari.soru_sayisi"
                  (ngModelChange)="updateSorular($event)"
                  name="edit_soru_sayisi"
                  min="1" 
                  [max]="maxSoruSayisi"
                  required
                >
              </div>

              <div class="form-field">
                <label class="field-label">Sınav Tarihi</label>
                <input 
                  type="date" 
                  class="modern-input"
                  [(ngModel)]="currentEditingCevapAnahtari.tarih"
                  name="edit_tarih"
                  required
                >
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3 class="section-title">Cevap Anahtarı</h3>
            <div class="answers-grid">
              <div class="answer-item" *ngFor="let i of getSoruDizisi(currentEditingCevapAnahtari); let idx = index">
                <div class="question-number">{{ idx + 1 }}</div>
                <div class="answer-inputs">
                  <input 
                    type="text" 
                    class="answer-input"
                    [(ngModel)]="currentEditingCevapAnahtari.cevaplar['ca' + (idx + 1)]"
                    [name]="'edit_ca' + (idx + 1)"
                    maxlength="1" 
                    placeholder="A"
                    required
                  >
                  <input 
                    type="text" 
                    class="topic-input"
                    [(ngModel)]="currentEditingCevapAnahtari.konular['ka' + (idx + 1)]"
                    [name]="'edit_ka' + (idx + 1)"
                    placeholder="Konu"
                  >
                  <input 
                    type="text" 
                    class="video-input"
                    [(ngModel)]="currentEditingCevapAnahtari.videolar['va' + (idx + 1)]"
                    [name]="'edit_va' + (idx + 1)"
                    placeholder="Video URL"
                  >
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="modern-btn secondary" (click)="cancelEdit()">
          <i class="fas fa-times"></i>
          İptal
        </button>
        <button type="button" class="modern-btn primary" [disabled]="submitting" (click)="submitEditForm()">
          <i class="fas fa-save"></i>
          {{ submitting ? 'Güncelleniyor...' : 'Güncelle' }}
        </button>
      </div>
    </div>
  </div>
</div>