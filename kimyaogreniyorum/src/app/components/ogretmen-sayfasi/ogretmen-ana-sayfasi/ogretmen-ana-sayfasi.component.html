<div class="dashboard-container">
  <!-- Modern Header Section -->
  <div class="modern-page-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="modern-page-title">
          <i class="bi bi-speedometer2 me-2"></i>
          Öğretmen Dashboard
        </h1>
        <p class="modern-page-description">
          Hoş geldiniz, {{ teacherName }}! Sınıflarınızı ve öğrencilerinizi yönetin.
        </p>
      </div>

      <!-- Quick Stats Overview -->
      <div class="admin-overview">
        <div class="stat-card mavi">
          <div class="stat-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-content">
            <h3>{{ dashboardStats.totalStudents }}</h3>
            <p>Toplam Öğrenci</p>
          </div>
        </div>

        <div class="stat-card yesil">
          <div class="stat-icon">
            <i class="fas fa-user-check"></i>
          </div>
          <div class="stat-content">
            <h3>{{ dashboardStats.activeStudents }}</h3>
            <p>Aktif Öğrenci</p>
          </div>
        </div>

        <div class="stat-card turuncu">
          <div class="stat-icon">
            <i class="fas fa-layer-group"></i>
          </div>
          <div class="stat-content">
            <h3>{{ dashboardStats.totalGroups }}</h3>
            <p>Aktif Grup</p>
          </div>
        </div>

        <div class="stat-card mor">
          <div class="stat-icon">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <div class="stat-content">
            <h3>{{ formatCurrency(dashboardStats.completedTopics) }}</h3>
            <p>Toplam Ücret</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Dashboard Grid -->
  <div class="admin-grid">
    <!-- New Students -->
    <div class="admin-container grid-6">
      <div class="card-header">
        <h3>
          <i class="bi bi-person-plus-fill me-2"></i>
          Yeni Kayıt Olan Öğrenciler
        </h3>
        <span class="badge bg-primary">{{ newStudents.length }}</span>
      </div>

      <div class="card-body">
        <div class="new-students-list" *ngIf="newStudents.length > 0; else noNewStudents">
          <div class="student-card" *ngFor="let student of newStudents">
            <div class="student-info">
              <div class="student-avatar">
                <i class="bi bi-person-circle"></i>
              </div>
              <div class="student-details">
                <h4>{{ student.adi_soyadi }}</h4>
                <p class="student-email">{{ student.email }}</p>
                <p class="student-school" *ngIf="student.okulu">{{ student.okulu }} - {{ student.sinifi }}</p>
                <p class="student-date">{{ formatDate(student.kayit_tarihi) }}</p>
              </div>
            </div>
            <div class="student-actions">
              <button class="approve-btn" (click)="approveNewStudent(student.id)" title="Onayla">
                <i class="bi bi-check-circle"></i>
              </button>
              <button class="reject-btn" (click)="rejectNewStudent(student.id)" title="Reddet">
                <i class="bi bi-x-circle"></i>
              </button>
            </div>
          </div>
        </div>

        <ng-template #noNewStudents>
          <div class="empty-state">
            <i class="bi bi-person-check fs-1 text-muted"></i>
            <p class="text-muted mt-2">Yeni kayıt olan öğrenci bulunmuyor.</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Last Exam Results -->
    <div class="admin-container grid-6">
      <div class="card-header">
        <h3>
          <i class="fas fa-chart-bar me-2"></i>
          Son Sınav Sonuçları
        </h3>
        <div class="card-actions">
          <button class="btn-primary btn-sm" (click)="navigateToExamResults()">Tüm Sonuçlar</button>
        </div>
      </div>
      <div class="card-body">
        <div *ngIf="isLoadingLastExam" class="loading-state">
          <div class="spinner-border spinner-border-sm" role="status"></div>
          <span class="ms-2">Yükleniyor...</span>
        </div>

        <div class="exam-results-list" *ngIf="!isLoadingLastExam && lastExamResults.length > 0">
          <div class="exam-result-item" *ngFor="let result of lastExamResults">
            <div class="student-info">
              <div class="student-avatar">
                <i class="bi bi-person-circle"></i>
              </div>
              <div class="student-details">
                <h4>{{ result.ogrenci_adi }}</h4>
                <p class="exam-name">{{ result.sinav_adi }}</p>
              </div>
            </div>
            <div class="result-stats">
              <div class="stat-grid">
                <div class="stat-item success">
                  <span class="stat-value">{{ result.dogru_sayisi }}</span>
                  <span class="stat-label">D</span>
                </div>
                <div class="stat-item error">
                  <span class="stat-value">{{ result.yanlis_sayisi }}</span>
                  <span class="stat-label">Y</span>
                </div>
                <div class="stat-item info">
                  <span class="stat-value">{{ calculateNet(result) | number:'1.1-1' }}</span>
                  <span class="stat-label">Net</span>
                </div>
              </div>
              <div class="performance-badge" [ngClass]="getPerformanceClass(result.yuzde)">
                {{ result.yuzde }}%
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!isLoadingLastExam && lastExamResults.length === 0" class="empty-state">
          <i class="bi bi-file-earmark-text text-muted"></i>
          <p class="text-muted mt-2">Henüz sınav sonucu bulunmuyor.</p>
        </div>
      </div>
    </div>

    <!-- Today's Schedule -->
    <div class="admin-container grid-8">
      <div class="card-header">
        <h3>
          <i class="fas fa-calendar-day me-2"></i>
          Bugünkü Derslerim ({{ todayName }})
        </h3>
        <div class="card-actions">
          <a routerLink="/ogretmen-sayfasi/ogretmen-haftalik-program-sayfasi" class="btn-primary btn-sm">Haftalık Program</a>
        </div>
      </div>
      <div class="card-body">
        <div class="today-schedule" *ngIf="dailySchedule.length > 0; else noLessonsToday">
          <div class="lesson-item" *ngFor="let ders of dailySchedule">
            <div class="lesson-time">
              <i class="fas fa-clock me-2"></i>
              {{ ders.ders_saati }}
            </div>
            <div class="lesson-info">
              <div class="group-name">
                <i class="fas fa-users me-1"></i>
                {{ ders.grup_adi }}
              </div>
              <div class="students-list" *ngIf="ders.ogrenciler && ders.ogrenciler.length > 0">
                <span class="student-count">
                  {{ ders.ogrenciler.length }} öğrenci
                </span>
                <div class="student-names">
                  {{ ders.ogrenciler.join(', ') }}
                </div>
              </div>
              <div class="lesson-info">
              <div class="group-name">
                <i class="fas fa-users me-1"></i>
                {{ ders.grup_adi }}
              </div>
              <div class="students-list">
                <span class="student-count" *ngIf="ders.ogrenciler && ders.ogrenciler.length > 0">
                  {{ ders.ogrenciler.length }} öğrenci
                </span>
                <span class="student-count" *ngIf="!ders.ogrenciler || ders.ogrenciler.length === 0">
                  Öğrenci bilgisi alınamadı
                </span>
                <div class="student-names" *ngIf="ders.ogrenciler && ders.ogrenciler.length > 0">
                  {{ ders.ogrenciler.join(', ') }}
                </div>
              </div>
              <div class="lesson-fee">{{ formatCurrency(ders.ucret) }}</div>
            </div>
            </div>
          </div>
        </div>

        <ng-template #noLessonsToday>
          <div class="no-lessons">
            <i class="fas fa-calendar-check"></i>
            <p>Bugün ders bulunmamaktadır.</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Upcoming Payments -->
    <div class="admin-container grid-4">
      <div class="card-header">
        <h3>
          <i class="fas fa-money-bill me-2"></i>
          Yaklaşan Ödemeler
        </h3>
        <div class="card-actions">
          <a routerLink="/ogretmen-sayfasi/ogretmen-ucret-sayfasi" class="btn-primary btn-sm">Tümünü Gör</a>
        </div>
      </div>
      <div class="card-body">
        <div *ngIf="isLoadingPayments" class="loading-state">
          <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
          <span class="ms-2">Yükleniyor...</span>
        </div>

        <div class="payment-list" *ngIf="!isLoadingPayments">
          <div class="payment-item" *ngFor="let payment of upcomingPayments.slice(0, 4)">
            <div class="payment-info">
              <div class="student-details">
                <h4>{{ payment.adi_soyadi }}</h4>
                <p>{{ payment.grubu }} • {{ payment.ders_sayisi }} ders</p>
              </div>
              <div class="payment-amount">
                <span class="amount">{{ formatCurrency(payment.ucret) }}</span>
                <span class="due-date" *ngIf="payment.son_odeme_tarihi">
                  {{ payment.son_odeme_tarihi | date:'dd/MM' }}
                </span>
              </div>
            </div>
            <div class="payment-status pending">
              <i class="bi bi-clock"></i>
            </div>
          </div>

          <div *ngIf="upcomingPayments.length === 0" class="no-payments">
            <i class="bi bi-check-circle text-success"></i>
            <p>Tüm ödemeler tamamlandı!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Upcoming Classes -->
    <div class="admin-container grid-4">
      <div class="card-header">
        <h3>
          <i class="fas fa-calendar-alt me-2"></i>
          Yaklaşan Dersler
        </h3>
        <div class="card-actions">
          <a routerLink="/ogretmen-sayfasi/ogretmen-haftalik-program-sayfasi" class="btn-primary btn-sm">Program</a>
        </div>
      </div>
      <div class="card-body">
        <div *ngIf="isLoadingClasses" class="loading-state">
          <div class="spinner-border spinner-border-sm" role="status"></div>
          <span class="ms-2">Yükleniyor...</span>
        </div>

        <div class="class-list" *ngIf="!isLoadingClasses">
          <div class="class-item" *ngFor="let class of upcomingClasses">
            <div class="class-time">
              <span class="time">{{ class.time }}</span>
              <span class="duration">{{ class.duration }}</span>
            </div>
            <div class="class-info">
              <h4>{{ class.subject }}</h4>
              <p>{{ class.group }} • {{ class.studentCount }} Öğrenci</p>
            </div>
            <div class="class-status" [ngClass]="class.status">
              <i class="fas" [ngClass]="class.status === 'active' ? 'fa-play' : 'fa-clock'"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Student Progress -->
    <div class="admin-container grid-6">
      <div class="card-header">
        <h3>
          <i class="fas fa-chart-pie me-2"></i>
          Öğrenci İlerlemesi
        </h3>
        <div class="card-actions">
          <a routerLink="/ogretmen-sayfasi/ogretmen-ogrenci-listesi-sayfasi" class="view-all">Detaylar</a>
        </div>
      </div>
      <div class="card-body">
        <div *ngIf="isLoadingProgress" class="loading-state">
          <div class="spinner-border spinner-border-sm" role="status"></div>
          <span class="ms-2">Yükleniyor...</span>
        </div>

        <div class="progress-list" *ngIf="!isLoadingProgress">
          <div class="progress-item" *ngFor="let student of studentProgress">
            <div class="student-info">
              <div class="student-avatar">
                <img [src]="student.avatar" [alt]="student.name" />
              </div>
              <div class="student-details">
                <h4>{{ student.name }}</h4>
                <p>{{ student.subject }}</p>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="student.progress"></div>
              <span class="progress-text">{{ student.progress }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="admin-container grid-6">
      <div class="card-header">
        <h3>
          <i class="fas fa-tachometer-alt me-2"></i>
          Özet İstatistikler
        </h3>
      </div>
      <div class="card-body">
        <div *ngIf="isLoadingStats" class="loading-state">
          <div class="spinner-border spinner-border-sm" role="status"></div>
          <span class="ms-2">Yükleniyor...</span>
        </div>

        <div class="stats-mini" *ngIf="!isLoadingStats">
          <div class="mini-stat">
            <div class="mini-icon primary">
              <i class="fas fa-book"></i>
            </div>
            <div class="mini-content">
              <h4>{{ dashboardStats.totalTopics }}</h4>
              <p>Toplam Konu</p>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon success">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="mini-content">
              <h4>{{ formatCurrency(dashboardStats.completedTopics) }}</h4>
              <p>Toplam Ücret</p>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon warning">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="mini-content">
              <h4>{{ dashboardStats.totalExams }}</h4>
              <p>Toplam Sınav</p>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon info">
              <i class="fas fa-user-minus"></i>
            </div>
            <div class="mini-content">
              <h4>{{ dashboardStats.inactiveStudents }}</h4>
              <p>Pasif Öğrenci</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>