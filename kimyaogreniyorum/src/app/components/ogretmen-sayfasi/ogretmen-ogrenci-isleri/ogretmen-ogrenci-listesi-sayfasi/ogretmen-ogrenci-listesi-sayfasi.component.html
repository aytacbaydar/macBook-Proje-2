<div class="modern-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">
          <i class="bi bi-people-fill"></i>
          Öğrenci Listesi
        </h1>
        <p class="page-subtitle">
          Toplam <span class="highlight">{{ filteredStudents.length }}</span> öğrenci kayıtlı
        </p>
      </div>
      <div class="header-actions">
        <div class="stats-cards">
          <div class="stat-card active">
            <div class="stat-icon">
              <i class="bi bi-person-check-fill"></i>
            </div>
            <div class="stat-content">
              <span class="stat-number">{{ activeStudentsCount }}</span>
              <span class="stat-label">Aktif</span>
            </div>
          </div>
          <div class="stat-card inactive">
            <div class="stat-icon">
              <i class="bi bi-person-x-fill"></i>
            </div>
            <div class="stat-content">
              <span class="stat-number">{{ inactiveStudentsCount }}</span>
              <span class="stat-label">Pasif</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <div class="search-container">
      <div class="search-input-wrapper">
        <i class="bi bi-search search-icon"></i>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="filterStudents()"
          placeholder="Öğrenci ara (isim, email, okul...)"
          class="search-input">
        <button *ngIf="searchTerm" (click)="clearSearch()" class="clear-search">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
    </div>

    <div class="filter-container">
      <div class="filter-group">
        <label class="filter-label">Grup:</label>
        <select [(ngModel)]="selectedGroup" (change)="filterStudents()" class="filter-select">
          <option value="">Tüm Gruplar</option>
          <option *ngFor="let group of uniqueGroups" [value]="group">{{ group }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Okul:</label>
        <select [(ngModel)]="selectedSchool" (change)="filterStudents()" class="filter-select">
          <option value="">Tüm Okullar</option>
          <option *ngFor="let school of uniqueSchools" [value]="school">{{ school }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Durum:</label>
        <select [(ngModel)]="selectedStatus" (change)="filterStudents()" class="filter-select">
          <option value="">Tümü</option>
          <option value="1">Aktif</option>
          <option value="0">Pasif</option>
        </select>
      </div>

      <button (click)="clearAllFilters()" class="clear-filters-btn">
        <i class="bi bi-arrow-clockwise"></i>
        Temizle
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p class="loading-text">Öğrenciler yükleniyor...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <div class="error-content">
      <i class="bi bi-exclamation-triangle-fill error-icon"></i>
      <h3 class="error-title">Bir hata oluştu</h3>
      <p class="error-message">{{ error }}</p>
      <button (click)="loadStudents()" class="retry-btn">
        <i class="bi bi-arrow-clockwise"></i>
        Tekrar Dene
      </button>
    </div>
  </div>

  <!-- Students Grid -->
  <div *ngIf="!isLoading && !error" class="students-section">
    <div class="section-header">
      <div class="results-info">
        <span class="results-count">{{ filteredStudents.length }} sonuç bulundu</span>
        <div class="view-toggle">
          <button 
            [class.active]="viewMode === 'grid'"
            (click)="viewMode = 'grid'"
            class="view-btn"
            title="Kart Görünümü">
            <i class="bi bi-grid-3x3-gap-fill"></i>
          </button>
          <button 
            [class.active]="viewMode === 'list'"
            (click)="viewMode = 'list'"
            class="view-btn"
            title="Liste Görünümü">
            <i class="bi bi-list-ul"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Grid View -->
    <div *ngIf="viewMode === 'grid'" class="students-grid">
      <div *ngFor="let student of paginatedStudents; trackBy: trackByStudentId" class="student-card">
        <div class="card-header">
          <div class="avatar-section">
            <div class="avatar-wrapper" (click)="openAvatarModal(student)">
              <img 
                [src]="student.avatar || getDefaultAvatar(student.adi_soyadi)" 
                [alt]="student.adi_soyadi"
                class="student-avatar"
                onerror="this.src='https://ui-avatars.com/api/?name=' + encodeURIComponent(this.alt) + '&background=007bff&color=fff&size=80'">
              <div class="avatar-overlay">
                <i class="bi bi-zoom-in"></i>
              </div>
            </div>
            <div class="status-indicator" [class.active]="student.aktif" [class.inactive]="!student.aktif">
              <i class="bi" [class.bi-check-circle-fill]="student.aktif" [class.bi-x-circle-fill]="!student.aktif"></i>
            </div>
          </div>
          <div class="card-actions">
            <div class="dropdown">
              <button class="action-btn dropdown-toggle" data-bs-toggle="dropdown">
                <i class="bi bi-three-dots-vertical"></i>
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" [routerLink]="['/ogretmen-sayfasi/ogretmen-ogrenci-bilgi-sayfasi', student.id]">
                  <i class="bi bi-info-circle"></i> Detay Görüntüle
                </a></li>
                <li><a class="dropdown-item" href="#" (click)="openMessageModal(student)">
                  <i class="bi bi-chat-dots"></i> Mesaj Gönder
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-warning" href="#" (click)="toggleStudentStatus(student)">
                  <i class="bi" [class.bi-person-check]="!student.aktif" [class.bi-person-x]="student.aktif"></i> 
                  {{ student.aktif ? 'Pasif Yap' : 'Aktif Yap' }}
                </a></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="card-body">
          <h3 class="student-name">{{ student.adi_soyadi }}</h3>
          <p class="student-email">{{ student.email }}</p>

          <div class="student-info">
            <div class="info-item">
              <i class="bi bi-building"></i>
              <span>{{ student.okulu }}</span>
            </div>
            <div class="info-item">
              <i class="bi bi-mortarboard"></i>
              <span>{{ student.sinifi }}</span>
            </div>
            <div class="info-item">
              <i class="bi bi-people"></i>
              <span>{{ student.grubu }} Grubu</span>
            </div>
            <div class="info-item">
              <i class="bi bi-book"></i>
              <span>{{ student.ders_adi }}</span>
            </div>
          </div>

          <div class="student-schedule">
            <div class="schedule-item">
              <i class="bi bi-calendar3"></i>
              <span>{{ student.ders_gunu }}</span>
            </div>
            <div class="schedule-item">
              <i class="bi bi-clock"></i>
              <span>{{ student.ders_saati }}</span>
            </div>
          </div>

          <div class="student-contact" *ngIf="student.cep_telefonu">
            <div class="contact-item">
              <i class="bi bi-phone"></i>
              <span>{{ student.cep_telefonu }}</span>
            </div>
          </div>
        </div>

        <div class="card-footer">
          <div class="fee-info">
            <span class="fee-label">Aylık Ücret:</span>
            <span class="fee-amount">{{ formatCurrency(student.ucret) }}</span>
          </div>
          <button 
            [routerLink]="['/ogretmen-sayfasi/ogretmen-ogrenci-bilgi-sayfasi', student.id]"
            class="detail-btn">
            <i class="bi bi-arrow-right"></i>
            Detay
          </button>
        </div>
      </div>
    </div>

    <!-- List View -->
    <div *ngIf="viewMode === 'list'" class="students-list">
      <div class="list-header">
        <div class="list-col avatar-col">Fotoğraf</div>
        <div class="list-col name-col">Adı Soyadı</div>
        <div class="list-col contact-col">İletişim</div>
        <div class="list-col school-col">Okul Bilgileri</div>
        <div class="list-col lesson-col">Ders Bilgileri</div>
        <div class="list-col fee-col">Ücret</div>
        <div class="list-col status-col">Durum</div>
        <div class="list-col actions-col">İşlemler</div>
      </div>

      <div *ngFor="let student of paginatedStudents; trackBy: trackByStudentId" class="list-item">
        <div class="list-col avatar-col">
          <div class="list-avatar" (click)="openAvatarModal(student)">
            <img 
              [src]="student.avatar || getDefaultAvatar(student.adi_soyadi)" 
              [alt]="student.adi_soyadi"
              class="avatar-img"
              onerror="this.src='https://ui-avatars.com/api/?name=' + encodeURIComponent(this.alt) + '&background=007bff&color=fff&size=40'">
          </div>
        </div>
        <div class="list-col name-col">
          <div class="name-info">
            <span class="name">{{ student.adi_soyadi }}</span>
            <span class="email">{{ student.email }}</span>
          </div>
        </div>
        <div class="list-col contact-col">
          <div class="contact-info">
            <span *ngIf="student.cep_telefonu" class="phone">
              <i class="bi bi-phone"></i> {{ student.cep_telefonu }}
            </span>
          </div>
        </div>
        <div class="list-col school-col">
          <div class="school-info">
            <span class="school">{{ student.okulu }}</span>
            <span class="class">{{ student.sinifi }}</span>
          </div>
        </div>
        <div class="list-col lesson-col">
          <div class="lesson-info">
            <span class="subject">{{ student.ders_adi }}</span>
            <span class="group">{{ student.grubu }} Grubu</span>
            <span class="schedule">{{ student.ders_gunu }} - {{ student.ders_saati }}</span>
          </div>
        </div>
        <div class="list-col fee-col">
          <span class="fee">{{ formatCurrency(student.ucret) }}</span>
        </div>
        <div class="list-col status-col">
          <span class="status-badge" [class.active]="student.aktif" [class.inactive]="!student.aktif">
            <i class="bi" [class.bi-check-circle-fill]="student.aktif" [class.bi-x-circle-fill]="!student.aktif"></i>
            {{ student.aktif ? 'Aktif' : 'Pasif' }}</span>
        </div>
        <div class="list-col actions-col">
          <div class="action-buttons">
            <button 
              [routerLink]="['/ogretmen-sayfasi/ogretmen-ogrenci-bilgi-sayfasi', student.id]"
              class="action-btn detail"
              title="Detay Görüntüle">
              <i class="bi bi-info-circle"></i>
            </button>
            <button 
              (click)="openMessageModal(student)"
              class="action-btn message"
              title="Mesaj Gönder">
              <i class="bi bi-chat-dots"></i>
            </button>
            <button 
              (click)="toggleStudentStatus(student)"
              class="action-btn toggle"
              [title]="student.aktif ? 'Pasif Yap' : 'Aktif Yap'">
              <i class="bi" [class.bi-person-check]="!student.aktif" [class.bi-person-x]="student.aktif"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredStudents.length === 0 && !isLoading" class="empty-state">
      <div class="empty-icon">
        <i class="bi bi-people"></i>
      </div>
      <h3 class="empty-title">Öğrenci bulunamadı</h3>
      <p class="empty-message">
        {{ searchTerm || selectedGroup || selectedSchool || selectedStatus ? 
           'Arama kriterlerinize uygun öğrenci bulunamadı.' : 
           'Henüz hiç öğrenci bulunmuyor.' }}
      </p>
      <button *ngIf="searchTerm || selectedGroup || selectedSchool || selectedStatus" 
              (click)="clearAllFilters()" 
              class="clear-filters-btn">
        <i class="bi bi-arrow-clockwise"></i>
        Filtreleri Temizle
      </button>
    </div>

    <!-- Pagination -->
    <div *ngIf="filteredStudents.length > 0" class="pagination-container">
      <div class="pagination-info">
        <span class="results-count">
          {{ filteredStudents.length }} öğrenciden {{ (currentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentPage * itemsPerPage, filteredStudents.length) }} arası gösteriliyor
        </span>

        <div class="items-per-page">
          <label>Sayfa başına:</label>
          <select [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()" class="items-select">
            <option [value]="10">10</option>
            <option [value]="15">15</option>
            <option [value]="20">20</option>
            <option [value]="25">25</option>
          </select>
        </div>
      </div>

      <nav class="pagination-nav" *ngIf="totalPages > 1">
        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
              <i class="bi bi-chevron-left"></i>
            </button>
          </li>

          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="currentPage === page">
            <button class="page-link" (click)="goToPage(page)" [disabled]="page === '...'">
              {{ page }}
            </button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
              <i class="bi bi-chevron-right"></i>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- Avatar Modal -->
  <div class="avatar-modal-overlay" *ngIf="showAvatarModal" (click)="closeAvatarModal()">
    <div class="avatar-modal-content" (click)="$event.stopPropagation()">
      <div class="avatar-modal-header">
        <h4 class="mb-0">{{ selectedStudent?.adi_soyadi }}</h4>
        <button type="button" class="close-btn" (click)="closeAvatarModal()">
          <i class="bi bi-x"></i>
        </button>
      </div>

      <div class="avatar-modal-body">
        <div class="large-avatar-container">
          <img 
            [src]="selectedStudent?.avatar || getDefaultAvatar(selectedStudent?.adi_soyadi || 'Student')" 
            [alt]="selectedStudent?.adi_soyadi"
            class="large-avatar"
            onerror="this.src='https://ui-avatars.com/api/?name=' + encodeURIComponent(this.alt) + '&background=007bff&color=fff&size=300'">
        </div>

        <div class="student-quick-info">
          <div class="info-item">
            <i class="bi bi-envelope"></i>
            <span>{{ selectedStudent?.email }}</span>
          </div>
          <div class="info-item" *ngIf="selectedStudent?.cep_telefonu">
            <i class="bi bi-phone"></i>
            <span>{{ selectedStudent?.cep_telefonu }}</span>
          </div>
          <div class="info-item">
            <i class="bi bi-building"></i>
            <span>{{ selectedStudent?.okulu }} - {{ selectedStudent?.sinifi }}</span>
          </div>
          <div class="info-item">
            <i class="bi bi-people"></i>
            <span>{{ selectedStudent?.grubu }} Grubu</span>
          </div>
        </div>
      </div>

      <div class="avatar-modal-footer">
        <button type="button" class="btn btn-primary" (click)="viewStudentDetails(selectedStudent?.id)">
          <i class="bi bi-info-circle me-2"></i>
          Detay Görüntüle
        </button>
        <button type="button" class="btn btn-secondary" (click)="closeAvatarModal()">
          <i class="bi bi-x-circle me-2"></i>
          Kapat
        </button>
      </div>
    </div>
  </div>
</div>