
<div class="devamsizlik-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-button" (click)="geriDon()">
        <i class="fas fa-arrow-left"></i>
        <span>Geri Dön</span>
      </button>
      
      <div class="header-title">
        <h1>
          <i class="fas fa-calendar-check"></i>
          Devamsızlık Takibi
        </h1>
        <p>Öğrenci devamsızlık kayıtlarını yönetin</p>
      </div>
    </div>
  </div>

  <!-- Controls Section -->
  <div class="controls-section">
    <div class="control-item">
      <label for="tarih">Tarih Seçin:</label>
      <input 
        type="date" 
        id="tarih"
        [(ngModel)]="secilenTarih" 
        (change)="tarihDegisti()"
        class="date-input">
    </div>

    <div class="bulk-actions">
      <button 
        class="btn btn-success" 
        (click)="tumunuIsaretle(false)"
        [disabled]="ogrenciler.length === 0">
        <i class="fas fa-check-circle"></i>
        Hepsini Devam Etti
      </button>
      
      <button 
        class="btn btn-danger" 
        (click)="tumunuIsaretle(true)"
        [disabled]="ogrenciler.length === 0">
        <i class="fas fa-times-circle"></i>
        Hepsini Devamsız
      </button>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="stats-section" *ngIf="ogrenciler.length > 0">
    <div class="stat-card success">
      <div class="stat-icon">
        <i class="fas fa-user-check"></i>
      </div>
      <div class="stat-content">
        <h3>{{ getDevamEdenSayisi() }}</h3>
        <p>Devam Eden</p>
      </div>
    </div>

    <div class="stat-card danger">
      <div class="stat-icon">
        <i class="fas fa-user-times"></i>
      </div>
      <div class="stat-content">
        <h3>{{ getDevamsizSayisi() }}</h3>
        <p>Devamsız</p>
      </div>
    </div>

    <div class="stat-card info">
      <div class="stat-icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-content">
        <h3>{{ ogrenciler.length }}</h3>
        <p>Toplam Öğrenci</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-section" *ngIf="yukleniyor">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <p>Öğrenciler yükleniyor...</p>
  </div>

  <!-- Error State -->
  <div class="error-section" *ngIf="hataVar">
    <div class="error-icon">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <h3>Bir Hata Oluştu</h3>
    <p>{{ hataMesaji }}</p>
    <button class="btn btn-primary" (click)="yenidenDene()">
      <i class="fas fa-redo"></i>
      Yeniden Dene
    </button>
  </div>

  <!-- Students List -->
  <div class="students-section" *ngIf="!yukleniyor && !hataVar">
    <div class="students-grid" *ngIf="ogrenciler.length > 0">
      <div 
        class="student-card" 
        *ngFor="let ogrenci of ogrenciler; trackBy: trackByFn"
        [class.absent]="ogrenci.devamsiz"
        [class.present]="!ogrenci.devamsiz">
        
        <div class="student-avatar">
          <img 
            [src]="ogrenci.avatar || getDefaultAvatar(ogrenci.adi_soyadi)"
            [alt]="ogrenci.adi_soyadi"
            (error)="$event.target.src = getDefaultAvatar(ogrenci.adi_soyadi)">
        </div>

        <div class="student-info">
          <h4>{{ ogrenci.adi_soyadi }}</h4>
          <div class="student-details">
            <span class="student-number">
              <i class="fas fa-id-card"></i>
              {{ ogrenci.ogrenci_numarasi }}
            </span>
            <span class="student-class">
              <i class="fas fa-graduation-cap"></i>
              {{ ogrenci.sinif }}
            </span>
          </div>
        </div>

        <div class="student-status">
          <div class="status-indicator" [class.absent]="ogrenci.devamsiz">
            <i class="fas" [class.fa-check]="!ogrenci.devamsiz" [class.fa-times]="ogrenci.devamsiz"></i>
          </div>
          
          <label class="status-toggle">
            <input 
              type="checkbox" 
              [(ngModel)]="ogrenci.devamsiz"
              (change)="devamsizlikDegisti(ogrenci)">
            <span class="toggle-slider"></span>
            <span class="toggle-label">
              {{ ogrenci.devamsiz ? 'Devamsız' : 'Devam Etti' }}
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="ogrenciler.length === 0 && !yukleniyor && !hataVar">
      <div class="empty-icon">
        <i class="fas fa-user-graduate"></i>
      </div>
      <h3>Öğrenci Bulunamadı</h3>
      <p>Bu öğretmene ait öğrenci kaydı bulunmuyor.</p>
      <button class="btn btn-primary" (click)="yenidenDene()">
        <i class="fas fa-redo"></i>
        Yeniden Yükle
      </button>
    </div>
  </div>

  <!-- Save Button -->
  <div class="save-section" *ngIf="ogrenciler.length > 0 && !yukleniyor && !hataVar">
    <button 
      class="save-button"
      (click)="devamsizliklariKaydet()"
      [disabled]="kaydetmeIsleminde || !secilenTarih">
      
      <i class="fas" [class.fa-save]="!kaydetmeIsleminde" [class.fa-spinner]="kaydetmeIsleminde" [class.fa-spin]="kaydetmeIsleminde"></i>
      <span>{{ kaydetmeIsleminde ? 'Kaydediliyor...' : 'Kaydet' }}</span>
    </button>
  </div>
</div>
