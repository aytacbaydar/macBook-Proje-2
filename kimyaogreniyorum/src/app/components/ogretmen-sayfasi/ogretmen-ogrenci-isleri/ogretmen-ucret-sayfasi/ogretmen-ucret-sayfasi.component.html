<p>ogretmen-ucret-sayfasi works!</p>
<div class="ucret-sayfasi-container">
  <!-- Header -->
  <div class="page-header">
    <h2><i class="bi bi-cash-stack"></i> Ücret Yönetimi</h2>
    <button class="btn btn-primary" (click)="openPaymentForm()">
      <i class="bi bi-plus-circle"></i> Yeni Ödeme Kaydı
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Yükleniyor...</span>
    </div>
    <p>Ücret verileri yükleniyor...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="bi bi-exclamation-triangle"></i>
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadPaymentData()">
      Tekrar Dene
    </button>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !error">
    
    <!-- Summary Cards -->
    <div class="summary-grid">
      <div class="summary-card expected">
        <div class="card-icon">
          <i class="bi bi-calculator"></i>
        </div>
        <div class="card-content">
          <h3>Bu Ay Beklenen</h3>
          <p class="amount">{{ formatCurrency(summary.totalExpected) }}</p>
          <span class="subtitle">{{ getActiveStudentsCount() }} aktif öğrenci</span>
        </div>
      </div>

      <div class="summary-card received">
        <div class="card-icon">
          <i class="bi bi-check-circle"></i>
        </div>
        <div class="card-content">
          <h3>Bu Ay Alınan</h3>
          <p class="amount">{{ formatCurrency(summary.totalReceived) }}</p>
          <span class="subtitle">{{ summary.studentsWhoPayThis.length }} öğrenci ödedi</span>
        </div>
      </div>

      <div class="summary-card yearly">
        <div class="card-icon">
          <i class="bi bi-calendar-year"></i>
        </div>
        <div class="card-content">
          <h3>Yıllık Toplam</h3>
          <p class="amount">{{ formatCurrency(summary.yearlyTotal) }}</p>
          <span class="subtitle">{{ summary.currentYear }} yılı</span>
        </div>
      </div>

      <div class="summary-card rate">
        <div class="card-icon">
          <i class="bi bi-graph-up"></i>
        </div>
        <div class="card-content">
          <h3>Toplama Oranı</h3>
          <p class="amount">%{{ getCollectionRate().toFixed(1) }}</p>
          <span class="subtitle">Bu ay için</span>
        </div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-section">
      <div class="progress-header">
        <span>Bu Ay Tahsilat Durumu</span>
        <span>{{ formatCurrency(summary.totalReceived) }} / {{ formatCurrency(summary.totalExpected) }}</span>
      </div>
      <div class="progress">
        <div class="progress-bar bg-success" 
             [style.width.%]="getCollectionRate()">
        </div>
      </div>
    </div>

    <!-- Students Who Paid This Month -->
    <div class="students-section">
      <h3><i class="bi bi-check-circle text-success"></i> Bu Ay Ödeme Yapan Öğrenciler ({{ summary.studentsWhoPayThis.length }})</h3>
      <div class="students-grid" *ngIf="summary.studentsWhoPayThis.length > 0">
        <div class="student-card paid" *ngFor="let student of summary.studentsWhoPayThis">
          <div class="student-info">
            <div class="student-avatar">
              <i class="bi bi-person-circle"></i>
            </div>
            <div class="student-details">
              <h4>{{ student.adi_soyadi }}</h4>
              <p>{{ student.email }}</p>
              <span class="group-badge" *ngIf="student.grubu">{{ student.grubu }}</span>
            </div>
          </div>
          <div class="payment-info">
            <span class="amount">{{ formatCurrency(parseFloat(student.ucret || '0')) }}</span>
            <button class="btn btn-sm btn-outline-primary" (click)="openPaymentForm(student)">
              <i class="bi bi-plus"></i> Ek Ödeme
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="summary.studentsWhoPayThis.length === 0" class="empty-state">
        <i class="bi bi-inbox"></i>
        <p>Bu ay henüz ödeme yapan öğrenci yok.</p>
      </div>
    </div>

    <!-- Students Who Didn't Pay -->
    <div class="students-section">
      <h3><i class="bi bi-x-circle text-danger"></i> Bu Ay Ödeme Yapmayan Öğrenciler ({{ summary.studentsWhoDidntPay.length }})</h3>
      <div class="students-grid" *ngIf="summary.studentsWhoDidntPay.length > 0">
        <div class="student-card unpaid" *ngFor="let student of summary.studentsWhoDidntPay">
          <div class="student-info">
            <div class="student-avatar">
              <i class="bi bi-person-circle"></i>
            </div>
            <div class="student-details">
              <h4>{{ student.adi_soyadi }}</h4>
              <p>{{ student.email }}</p>
              <span class="group-badge" *ngIf="student.grubu">{{ student.grubu }}</span>
            </div>
          </div>
          <div class="payment-info">
            <span class="amount pending">{{ formatCurrency(parseFloat(student.ucret || '0')) }}</span>
            <button class="btn btn-sm btn-success" (click)="openPaymentForm(student)">
              <i class="bi bi-cash"></i> Ödeme Al
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="summary.studentsWhoDidntPay.length === 0" class="empty-state success">
        <i class="bi bi-check-circle text-success"></i>
        <p>Tüm öğrenciler bu ay ödemelerini yapmış!</p>
      </div>
    </div>

    <!-- Recent Payments -->
    <div class="payments-section">
      <h3><i class="bi bi-clock-history"></i> Bu Ay Yapılan Ödemeler ({{ payments.length }})</h3>
      <div class="payments-table" *ngIf="payments.length > 0">
        <div class="payment-row header">
          <div>Öğrenci</div>
          <div>Tutar</div>
          <div>Tarih</div>
          <div>Açıklama</div>
        </div>
        <div class="payment-row" *ngFor="let payment of payments">
          <div class="student-name">{{ payment.ogrenci_adi }}</div>
          <div class="amount">{{ formatCurrency(payment.tutar) }}</div>
          <div class="date">{{ payment.odeme_tarihi | date:'dd/MM/yyyy HH:mm' }}</div>
          <div class="description">{{ payment.aciklama || '-' }}</div>
        </div>
      </div>
      <div *ngIf="payments.length === 0" class="empty-state">
        <i class="bi bi-inbox"></i>
        <p>Bu ay henüz ödeme kaydı yok.</p>
      </div>
    </div>
  </div>

  <!-- Payment Form Modal -->
  <div class="modal-overlay" *ngIf="showPaymentForm" (click)="closePaymentForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="bi bi-cash"></i>
          {{ selectedStudent ? selectedStudent.adi_soyadi + ' - Ödeme Kaydı' : 'Yeni Ödeme Kaydı' }}
        </h3>
        <button class="btn-close" (click)="closePaymentForm()">
          <i class="bi bi-x"></i>
        </button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="submitPayment()">
          <div class="form-group" *ngIf="!selectedStudent">
            <label>Öğrenci Seç</label>
            <select class="form-control" [(ngModel)]="paymentForm.ogrenci_id" name="ogrenci_id" required>
              <option value="0">Öğrenci seçin...</option>
              <option *ngFor="let student of students" [value]="student.id">
                {{ student.adi_soyadi }} - {{ formatCurrency(parseFloat(student.ucret || '0')) }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Ödeme Tutarı (TL)</label>
            <input type="number" 
                   class="form-control" 
                   [(ngModel)]="paymentForm.tutar" 
                   name="tutar" 
                   step="0.01" 
                   min="0" 
                   required>
          </div>

          <div class="form-group">
            <label>Ödeme Tarihi</label>
            <input type="date" 
                   class="form-control" 
                   [(ngModel)]="paymentForm.odeme_tarihi" 
                   name="odeme_tarihi" 
                   required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Ay</label>
              <select class="form-control" [(ngModel)]="paymentForm.ay" name="ay" required>
                <option *ngFor="let month of months" [value]="month.value">
                  {{ month.name }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Yıl</label>
              <input type="number" 
                     class="form-control" 
                     [(ngModel)]="paymentForm.yil" 
                     name="yil" 
                     min="2020" 
                     max="2030" 
                     required>
            </div>
          </div>

          <div class="form-group">
            <label>Açıklama (İsteğe bağlı)</label>
            <textarea class="form-control" 
                      [(ngModel)]="paymentForm.aciklama" 
                      name="aciklama" 
                      rows="3" 
                      placeholder="Ödeme ile ilgili not..."></textarea>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="closePaymentForm()">
              İptal
            </button>
            <button type="submit" class="btn btn-success">
              <i class="bi bi-check"></i> Ödeme Kaydını Kaydet
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
