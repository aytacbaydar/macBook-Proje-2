
<div class="student-online-lesson-container">
  <!-- Header -->
  <div class="lesson-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="bi bi-camera-video me-2"></i>
        Online Dersler
      </h1>
      <div class="lesson-status" [class.active]="isJoined">
        <i class="bi" [class.bi-record-circle]="isJoined" [class.bi-stop-circle]="!isJoined"></i>
        {{ isJoined ? 'DERSE KATILDINIZ' : 'DERSE KATILMADINIZ' }}
      </div>
    </div>
  </div>

  <!-- Available Lessons -->
  <div class="available-lessons" *ngIf="!isJoined">
    <div class="lessons-card">
      <h3>
        <i class="bi bi-list-ul me-2"></i>
        Mevcut Dersler ({{ studentInfo?.grubu }} Grubu)
      </h3>
      
      <div class="lessons-list" *ngIf="availableLessons.length > 0; else noLessons">
        <div class="lesson-item" *ngFor="let lesson of availableLessons">
          <div class="lesson-info">
            <h4>{{ lesson.lesson_title }}</h4>
            <p class="lesson-subject">{{ lesson.lesson_subject }}</p>
            <div class="lesson-meta">
              <span><i class="bi bi-person-circle"></i> {{ lesson.teacher_name }}</span>
              <span><i class="bi bi-clock"></i> {{ formatTime(lesson.created_at) }}</span>
            </div>
          </div>
          <button 
            class="btn btn-success join-btn"
            (click)="joinLesson(lesson)">
            <i class="bi bi-box-arrow-in-right me-2"></i>
            Derse Katıl
          </button>
        </div>
      </div>
      
      <ng-template #noLessons>
        <div class="no-lessons">
          <i class="bi bi-camera-video-off"></i>
          <p>Şu anda grubu için aktif ders bulunmuyor.</p>
          <small>Öğretmeniniz ders başlattığında burada görünecektir.</small>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Active Lesson Interface -->
  <div class="active-lesson" *ngIf="isJoined && currentLesson">
    
    <!-- Lesson Info Bar -->
    <div class="lesson-info-bar">
      <div class="info-item">
        <i class="bi bi-clock"></i>
        <span>{{ getCurrentTime }}</span>
      </div>
      <div class="info-item">
        <i class="bi bi-book"></i>
        <span>{{ currentLesson.lesson_title }}</span>
      </div>
      <div class="info-item">
        <i class="bi bi-person-circle"></i>
        <span>{{ currentLesson.teacher_name }}</span>
      </div>
      <button 
        class="btn btn-danger btn-sm leave-btn"
        (click)="leaveLesson()">
        <i class="bi bi-box-arrow-left me-1"></i>
        Dersten Ayrıl
      </button>
    </div>

    <!-- Main Content Area -->
    <div class="lesson-content">
      
      <!-- Canvas Area -->
      <div class="canvas-area">
        <div class="canvas-container">
          <canvas #studentCanvas id="studentCanvas"></canvas>
        </div>
        <div class="canvas-info">
          <i class="bi bi-info-circle"></i>
          <span>Öğretmenin tahtasını izliyorsunuz</span>
        </div>
      </div>

      <!-- Chat Area -->
      <div class="chat-area">
        <div class="chat-header">
          <h4>
            <i class="bi bi-chat-dots me-2"></i>
            Sohbet
          </h4>
        </div>
        
        <div class="chat-messages">
          <div class="message" 
               *ngFor="let message of chatMessages"
               [class.teacher-message]="message.sender_type === 'teacher'"
               [class.student-message]="message.sender_type === 'student'">
            <div class="message-header">
              <span class="sender-name">
                <i class="bi" [class.bi-person-badge]="message.sender_type === 'teacher'" 
                   [class.bi-person]="message.sender_type === 'student'"></i>
                {{ message.sender_name || (message.sender_type === 'teacher' ? 'Öğretmen' : 'Öğrenci') }}
              </span>
              <span class="message-time">{{ formatTime(message.timestamp) }}</span>
            </div>
            <div class="message-content">{{ message.message }}</div>
          </div>
          
          <div class="no-messages" *ngIf="chatMessages.length === 0">
            <i class="bi bi-chat text-muted"></i>
            <p class="text-muted mt-2">Henüz mesaj yok</p>
          </div>
        </div>
        
        <div class="chat-input">
          <div class="input-group">
            <input 
              type="text" 
              class="form-control" 
              [(ngModel)]="newChatMessage"
              placeholder="Mesajınızı yazın..."
              (keyup.enter)="sendChatMessage()">
            <button 
              class="btn btn-primary" 
              (click)="sendChatMessage()"
              [disabled]="!newChatMessage.trim()">
              <i class="bi bi-send"></i>
            </button>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
</div>
