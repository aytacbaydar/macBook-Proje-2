<div class="konu-analiz-container">

  <!-- Loading State -->
  <div *ngIf="loadingKonuAnalizi" class="loading-section text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">YÃ¼kleniyor...</span>
    </div>
    <p class="mt-3 text-muted">Konu analizi yÃ¼kleniyor...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loadingKonuAnalizi" class="alert alert-danger">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadData()">
      <i class="bi bi-arrow-clockwise me-1"></i>
      Tekrar Dene
    </button>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loadingKonuAnalizi && !error">

    <!-- Summary Statistics -->
    <div class="summary-stats-section" *ngIf="konuAnalizi.length > 0">
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-icon">
            <i class="bi bi-book"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getTotalTopics() }}</h3>
            <p>Toplam Konu</p>
          </div>
        </div>

        <div class="stat-card success">
          <div class="stat-icon">
            <i class="bi bi-percent"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getAverageSuccess() }}%</h3>
            <p>Ortalama BaÅŸarÄ±</p>
          </div>
        </div>

        <div class="stat-card info">
          <div class="stat-icon">
            <i class="bi bi-question-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getTotalQuestions() }}</h3>
            <p>Toplam Soru</p>
          </div>
        </div>

        <div class="stat-card warning">
          <div class="stat-icon">
            <i class="bi bi-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ getTotalCorrect() }}</h3>
            <p>DoÄŸru Cevap</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Level Distribution -->
    <div class="performance-distribution" *ngIf="konuAnalizi.length > 0">
      <h3><i class="bi bi-pie-chart me-2"></i>BaÅŸarÄ± Seviyesi DaÄŸÄ±lÄ±mÄ±</h3>
      <div class="distribution-grid">
        <div class="distribution-card excellent">
          <div class="distribution-icon">
            <i class="bi bi-trophy-fill"></i>
          </div>
          <div class="distribution-content">
            <h4>{{ getMukemmelKonuSayisi() }}</h4>
            <p>MÃ¼kemmel (80%+)</p>
          </div>
        </div>

        <div class="distribution-card good">
          <div class="distribution-icon">
            <i class="bi bi-star-fill"></i>
          </div>
          <div class="distribution-content">
            <h4>{{ getIyiKonuSayisi() }}</h4>
            <p>Ä°yi (60-79%)</p>
          </div>
        </div>

        <div class="distribution-card average">
          <div class="distribution-icon">
            <i class="bi bi-dash-circle-fill"></i>
          </div>
          <div class="distribution-content">
            <h4>{{ getOrtaKonuSayisi() }}</h4>
            <p>Orta (40-59%)</p>
          </div>
        </div>

        <div class="distribution-card needs-improvement">
          <div class="distribution-icon">
            <i class="bi bi-exclamation-triangle-fill"></i>
          </div>
          <div class="distribution-content">
            <h4>{{ getGelistirilmeliKonuSayisi() }}</h4>
            <p>GeliÅŸtirilmeli (0-39%)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Best and Worst Topics -->
    <div class="topics-highlights" *ngIf="konuAnalizi.length > 0">
      <div class="row">
        <!-- En Ä°yi Konular -->
        <div class="col-md-6">
          <div class="highlight-card success-topics">
            <h4><i class="bi bi-award me-2"></i>En Ä°yi KonularÄ±nÄ±z</h4>
            <div class="topics-list">
              <div class="topic-highlight-item" *ngFor="let konu of getEnIyiKonular(); let i = index">
                <div class="topic-rank">{{ i + 1 }}</div>
                <div class="topic-info">
                  <h6>{{ konu.konu_adi }}</h6>
                  <div class="topic-stats">
                    <span class="success-rate">{{ konu.basari_orani }}%</span>
                    <small class="text-muted">{{ konu.dogru_sayisi }}/{{ konu.toplam_soru }}</small>
                  </div>
                </div>
                <div class="topic-badge excellent">
                  <i class="bi bi-trophy"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- GeliÅŸtirilmesi Gereken Konular -->
        <div class="col-md-6">
          <div class="highlight-card improvement-topics">
            <h4><i class="bi bi-arrow-up-circle me-2"></i>GeliÅŸtirilmesi Gereken Konular</h4>
            <div class="topics-list">
              <div class="topic-highlight-item" *ngFor="let konu of getGelistirilmesiGerekenKonular(); let i = index">
                <div class="topic-rank warning">{{ i + 1 }}</div>
                <div class="topic-info">
                  <h6>{{ konu.konu_adi }}</h6>
                  <div class="topic-stats">
                    <span class="success-rate warning">{{ konu.basari_orani }}%</span>
                    <small class="text-muted">{{ konu.dogru_sayisi }}/{{ konu.toplam_soru }}</small>
                  </div>
                </div>
                <div class="topic-badge needs-work">
                  <i class="bi bi-arrow-up"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Topic Analysis -->
    <div class="detailed-analysis" *ngIf="konuAnalizi.length > 0">
      <h3><i class="bi bi-list-check me-2"></i>DetaylÄ± Konu Analizi</h3>

      <div class="analysis-description">
          <p class="text-muted">
            Bu analiz, Ã§Ã¶zdÃ¼ÄŸÃ¼nÃ¼z tÃ¼m sÄ±navlar ve yapay zeka destekli testlerdeki performansÄ±nÄ±za dayanarak hazÄ±rlanmÄ±ÅŸtÄ±r.
            Her konudaki baÅŸarÄ± oranÄ±nÄ±z, doÄŸru ve yanlÄ±ÅŸ cevaplarÄ±nÄ±z detaylÄ± olarak gÃ¶rÃ¼ntÃ¼lenmektedir.
          </p>
        </div>

      <div class="konu-analizi-container">
        <div class="konu-item" *ngFor="let konu of konuAnalizi; let i = index">
          <!-- Konu BaÅŸlÄ±ÄŸÄ± -->
          <div class="konu-header">
            <div class="konu-title-wrapper">
              <h6 class="konu-adi">{{ konu.konu_adi }}</h6>
              <span class="success-badge" [style.background-color]="getKonuSuccessColor(konu.basari_orani)">
                {{ getKonuSuccessText(konu.basari_orani) }}
              </span>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="progress-section">
            <div class="progress-bar-custom">
              <div class="progress-fill" 
                   [style.width.%]="konu.basari_orani"
                   [style.background-color]="getKonuSuccessColor(konu.basari_orani)">
                <span class="progress-text">{{ konu.basari_orani }}%</span>
              </div>
            </div>
          </div>

          <!-- Ä°statistikler - Mobile First Design -->
          <div class="stats-container">
            <div class="stat-item correct">
              <div class="stat-number">{{ konu.dogru_sayisi }}</div>
              <div class="stat-label">DoÄŸru</div>
            </div>
            <div class="stat-item wrong">
              <div class="stat-number">{{ konu.yanlis_sayisi }}</div>
              <div class="stat-label">YanlÄ±ÅŸ</div>
            </div>
            <div class="stat-item empty">
              <div class="stat-number">{{ konu.bos_sayisi }}</div>
              <div class="stat-label">BoÅŸ</div>
            </div>
            <div class="stat-item total">
              <div class="stat-number">{{ konu.toplam_soru }}</div>
              <div class="stat-label">Toplam</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loadingKonuAnalizi && !error && konuAnalizi.length === 0" class="empty-state text-center py-5">
      <div class="empty-content">
        <i class="bi bi-graph-up text-muted" style="font-size: 4rem;"></i>
        <h3 class="text-muted mt-3">HenÃ¼z Konu Analizi Yok</h3>
        <p class="text-muted">SÄ±nav Ã§Ã¶zdÃ¼kÃ§e konu baÅŸarÄ± analiziniz burada gÃ¶rÃ¼necek</p>
        <p class="text-muted">Hadi ilk sÄ±navÄ±nÄ± Ã§Ã¶z! ðŸ“Š</p>
      </div>
    </div>
  </div>
</div>