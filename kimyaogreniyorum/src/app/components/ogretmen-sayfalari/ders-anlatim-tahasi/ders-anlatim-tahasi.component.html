<div class="pdf-toolbar pdf-toolbar--sticky">
  <nav class="pdf-toolbar__nav" aria-label="PDF ara&#231; sekmeleri">
    <button
      type="button"
      class="toolbar-tab"
      *ngFor="let tab of toolbarTabs"
      (click)="setActiveTab(tab.id)"
      [class.aktif]="isActiveTab(tab.id)"
    >
      {{ tab.label }}
    </button>
  </nav>

      

  <header class="pdf-toolbar__panel" aria-live="polite">
    <ng-container [ngSwitch]="activeToolbarTab">
      <ng-container *ngSwitchCase="'dosya'">
        <div class="pdf-toolbar__group">
          <button
            type="button"
            class="btn-ikonlu"
            (click)="yeniSayfaEkle()"
            [disabled]="!isBlankDocument || exportInProgress"
          >
            <span class="ikon" aria-hidden="true">&#x2795;</span>
            <span>Sayfa Ekle</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="pdfUploadInput.click()"
            [disabled]="pdfYukleniyor"
          >
            <span class="ikon" aria-hidden="true">&#128196;</span>
            <span>PDF Ekle</span>
          </button>
          <input
            #pdfUploadInput
            type="file"
            accept="application/pdf"
            (change)="onPdfSec($event)"
            hidden
          >
          <button
            type="button"
            class="btn-ikonlu"
            (click)="triggerImageUpload()"
            [disabled]="pdfYukleniyor"
          >
            <span class="ikon" aria-hidden="true">&#128247;</span>
            <span>Fotograf Ekle</span>
          </button>
          <input
            #imageUploadInput
            type="file"
            accept="image/*"
            (change)="onImageSelected($event)"
            hidden
          >
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'kaydet'">
        <div class="kaydet-panel">
          <div
            class="kaydet-panel__nav"
            role="tablist"
            aria-label="Kaydet secenekleri"
          >
            <button
              type="button"
              class="kaydet-panel__tab"
              (click)="setKaydetPanelMode('lesson')"
              [class.aktif]="kaydetPanelMode === 'lesson'"
              [attr.aria-pressed]="kaydetPanelMode === 'lesson'"
            >
              <span>Ders Kaydi</span>
            </button>
            <button
              type="button"
              class="kaydet-panel__tab"
              (click)="setKaydetPanelMode('attendance')"
              [class.aktif]="kaydetPanelMode === 'attendance'"
              [attr.aria-pressed]="kaydetPanelMode === 'attendance'"
            >
              <span>Devamsizlik</span>
            </button>
          </div>

          <div class="kaydet-panel__content" *ngIf="kaydetPanelMode === 'lesson'">
            <div class="toolbar-form">
              <div class="toolbar-field">
                <label class="toolbar-label" for="kaydetGrup">Grup</label>
                <select
                  id="kaydetGrup"
                  class="toolbar-select"
                  [(ngModel)]="secilenGrup"
                  [ngModelOptions]="{ standalone: true }"
                  [disabled]="ogrenciGruplariYukleniyor"
                  (ngModelChange)="onGrupChange()"
                >
                  <option value="">Grup secin</option>
                  <option *ngFor="let grup of ogrenciGruplari" [value]="grup">{{ grup }}</option>
                </select>
              </div>

              <div class="toolbar-field">
                <label class="toolbar-label" for="kaydetKonu">Konu</label>
                <select
                  id="kaydetKonu"
                  class="toolbar-select"
                  [(ngModel)]="secilenKonu"
                  (ngModelChange)="onKonuChange($event)"
                  [disabled]="konularYukleniyor || !konuBasliklari.length"
                  [ngModelOptions]="{ standalone: true }"
                >
                  <option value="">Konu secin</option>
                  <option *ngFor="let konu of konuBasliklari" [value]="konu">{{ konu }}</option>
                </select>
              </div>

              <div class="toolbar-field">
                <label class="toolbar-label" for="kaydetAltKonu">Alt konu / kazan�m</label>
                <select
                  id="kaydetAltKonu"
                  class="toolbar-select"
                  [(ngModel)]="secilenAltKonu"
                  [disabled]="!altKonuSecenekleri.length"
                  [ngModelOptions]="{ standalone: true }"
                  (ngModelChange)="onAltKonuChange()"
                >
                  <option value="">Alt konu secin</option>
                  <option *ngFor="let alt of altKonuSecenekleri" [value]="alt">{{ alt }}</option>
                </select>
              </div>

              <button
                type="button"
                class="btn-ikonlu btn-primary"
                (click)="saveLessonRecord()"
                [disabled]="lessonSaveInProgress || pdfYukleniyor || exportInProgress || !canSaveLesson"
              >
                <span class="ikon" aria-hidden="true">&#128190;</span>
                <span>{{ lessonSaveInProgress ? 'Kaydediliyor...' : 'Kaydet' }}</span>
              </button>

              <button
                type="button"
                class="btn-ikonlu"
                (click)="downloadPdf()"
                [disabled]="pdfYukleniyor || exportInProgress"
              >
                <span class="ikon" aria-hidden="true">&#128229;</span>
                <span>PDF indir</span>
              </button>
            </div>

            <div class="toolbar-status" *ngIf="ogrenciGruplariYukleniyor || konularYukleniyor">
              <span *ngIf="ogrenciGruplariYukleniyor">Gruplar yukleniyor...</span>
              <span *ngIf="konularYukleniyor">Konular yukleniyor...</span>
            </div>
            <div class="toolbar-status toolbar-status--error" *ngIf="konularHataMesaji && !konularYukleniyor">
              {{ konularHataMesaji }}
            </div>
            <div class="toolbar-status toolbar-status--error" *ngIf="kaydetErrorMessage">
              {{ kaydetErrorMessage }}
            </div>
            <div class="toolbar-status toolbar-status--success" *ngIf="kaydetSuccessMessage">
              {{ kaydetSuccessMessage }}
            </div>
          </div>

          <div class="kaydet-panel__content" *ngIf="kaydetPanelMode === 'attendance'">
            <div class="kaydet-devamsizlik-wrapper">
              <app-ogretmen-devamsizlik-sayfasi></app-ogretmen-devamsizlik-sayfasi>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngSwitchCase="'duzenle'">
        <div class="pdf-toolbar__group">
          <button
            type="button"
            class="btn-ikonlu"
            (click)="setTool('select')"
            [class.aktif]="currentTool === 'select'"
          >
            <span class="ikon" aria-hidden="true">&#x270B;</span>
            <span>Se� &amp; Ta��</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="duplicateSelection()"
            [disabled]="!hasSelection || currentTool !== 'select'"
          >
            <span class="ikon" aria-hidden="true">&#x239C;</span>
            <span>Kopyala</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="pasteSelection()"
            [disabled]="!clipboardObject"
          >
            <span class="ikon" aria-hidden="true">&#x239F;</span>
            <span>Yap��t�r</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="cutSelection()"
            [disabled]="!hasSelection || currentTool !== 'select'"
          >
            <span class="ikon" aria-hidden="true">&#9986;</span>
            <span>Kes</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="deleteSelection()"
            [disabled]="!hasSelection || currentTool !== 'select'"
          >
            <span class="ikon" aria-hidden="true">&#x1F5D1;</span>
            <span>Sil</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="startCrop()"
            [disabled]="!hasSelection || isCropping"
          >
            <span class="ikon" aria-hidden="true">&#x2702;</span>
            <span>K�rp</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu btn-temizle"
            (click)="clearCurrentAnnotations()"
            [disabled]="!currentPage"
          >
            <span class="ikon" aria-hidden="true">&#x1F9F9;</span>
            <span>Temizle</span>
          </button>
        </div>

        <div class="pdf-toolbar__group pdf-toolbar__group--background">
          <span class="toolbar-label">Arka Plan</span>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="setBackground('plain')"
            [class.aktif]="backgroundMode === 'plain'"
            [disabled]="!isBlankDocument"
          >
            <span class="ikon" aria-hidden="true">&#9633;</span>
            <span>D�z</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="setBackground('grid')"
            [class.aktif]="backgroundMode === 'grid'"
            [disabled]="!isBlankDocument"
          >
            <span class="ikon" aria-hidden="true">&#x1F4C2;</span>
            <span>Kareli</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="setBackground('lined')"
            [class.aktif]="backgroundMode === 'lined'"
            [disabled]="!isBlankDocument"
          >
            <span class="ikon" aria-hidden="true">&#x1F4C4;</span>
            <span>�izgili</span>
          </button>
        </div>
      </ng-container>

      <ng-container *ngSwitchCase="'sekiller'">
        <div class="pdf-toolbar__group">
          <button type="button" class="btn-ikonlu" (click)="addShape('rectangle')">
            <span class="ikon" aria-hidden="true">&#9634;</span>
            <span>Dikd�rtgen</span>
          </button>
          <button type="button" class="btn-ikonlu" (click)="addShape('circle')">
            <span class="ikon" aria-hidden="true">&#9711;</span>
            <span>Daire</span>
          </button>
          <button type="button" class="btn-ikonlu" (click)="addShape('triangle')">
            <span class="ikon" aria-hidden="true">&#9651;</span>
            <span>��gen</span>
          </button>
          <button type="button" class="btn-ikonlu" (click)="addArrow()">
            <span class="ikon" aria-hidden="true">&#10148;</span>
            <span>Ok</span>
          </button>
        </div>
      </ng-container>

      <ng-container *ngSwitchCase="'cizgiler'">
        <div class="pdf-toolbar__group">
          <button
            type="button"
            class="btn-ikonlu"
            (click)="setTool('pen')"
            [class.aktif]="currentTool === 'pen'"
          >
            <span class="ikon" aria-hidden="true">&#9998;</span>
            <span>Kalem</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="setTool('highlighter')"
            [class.aktif]="currentTool === 'highlighter'"
          >
            <span class="ikon" aria-hidden="true">&#x1F58D;</span>
            <span>Fosforlu</span>
          </button>
          <button
            type="button"
            class="btn-ikonlu"
            (click)="setTool('eraser')"
            [class.aktif]="currentTool === 'eraser'"
          >
            <span class="ikon" aria-hidden="true">&#9003;</span>
            <span>Silgi</span>
          </button>
        </div>

        <div class="pdf-toolbar__group">
          <span class="toolbar-label">Kalem Rengi</span>
          <button
            type="button"
            class="renk-ikon-btn"
            *ngFor="let renk of penColorOptions"
            (click)="setPenColor(renk)"
            [style.backgroundColor]="renk"
            [class.aktif]="penColor === renk"
            [attr.aria-label]="'Kalem rengi ' + renk"
          ></button>
        </div>

        <div class="pdf-toolbar__group">
          <label class="toolbar-label" for="strokeSelect">Kal�nl�k</label>
          <select
            id="strokeSelect"
            class="stroke-select"
            name="strokeSize"
            [ngModelOptions]="{ standalone: true }"
            [(ngModel)]="strokeSize"
            (ngModelChange)="onStrokeSizeChange($event)"
          >
            <option *ngFor="let size of strokeSizeOptions" [value]="size">{{ size }} px</option>
          </select>
        </div>
      </ng-container>
    </ng-container>
  </header>
</div>


<div *ngIf="pdfYukleniyor" class="durum durum--ust">PDF y�kleniyor...</div>
<div *ngIf="pdfHataMesaji" class="durum hata durum--ust">{{ pdfHataMesaji }}</div>

<div class="pdf-gorunumu" #pdfContainer>
  <canvas #pdfCanvas class="pdf-canvas" aria-label="PDF g�r�n�m�"></canvas>
  <canvas
    #annotationCanvas
    class="annotation-canvas"
    aria-label="�izim alan�"
  ></canvas>

  <div
    class="selection-menu"
    *ngIf="selectionMenu.visible"
    [style.left.px]="selectionMenu.left"
    [style.top.px]="selectionMenu.top"
  >
    <ng-container *ngIf="selectionMenu.showCropActions; else selectionActions">
      <button type="button" class="selection-menu__button primary" (click)="confirmCrop()">
        <i class="fa-solid fa-crop-simple"></i>
        <span>K�rpmay� Onayla</span>
      </button>
      <button type="button" class="selection-menu__button" (click)="cancelCrop()">
        <i class="fa-solid fa-xmark"></i>
        <span>�ptal</span>
      </button>
    </ng-container>
    <ng-template #selectionActions>
      <button
        type="button"
        class="selection-menu__button"
        (click)="startCrop()"
        *ngIf="selectionMenu.showCrop"
      >
        <i class="fa-solid fa-crop-simple"></i>
        <span>K�rp</span>
      </button>
      <button type="button" class="selection-menu__button" (click)="duplicateSelection()">
        <i class="fa-solid fa-copy"></i>
        <span>Kopyala</span>
      </button>
      <button type="button" class="selection-menu__button" (click)="cutSelection()">
        <i class="fa-solid fa-copy"></i>
        <span>Kes</span>
      </button>
      <button type="button" class="selection-menu__button danger" (click)="deleteSelection()">
        <i class="fa-solid fa-copy"></i>
        <span>Sil</span>
      </button>
      <button
        type="button"
        class="selection-menu__button"
        *ngIf="selectionMenu.showPaste"
        (click)="pasteSelection()"
      >
        <i class="fa-solid fa-clipboard"></i>
        <span>Yap��t�r</span>
      </button>
    </ng-template>
  </div>
</div>

<div *ngIf="totalPages > 0" class="pdf-sayfa-alt-kontrol">
    <button type="button" (click)="ilkSayfa()" [disabled]="currentPage <= 1 || pdfYukleniyor">Ilk</button>
    <button type="button" (click)="oncekiSayfa()" [disabled]="currentPage <= 1 || pdfYukleniyor">Onceki</button>
  <span>Sayfa {{ currentPage }} / {{ totalPages }}</span>
  <button type="button" (click)="sonrakiSayfa()" [disabled]="currentPage >= totalPages || pdfYukleniyor">
    Sonraki
  </button>
  <button type="button" (click)="sonSayfa()" [disabled]="currentPage >= totalPages || pdfYukleniyor">Son</button>
</div>

 





