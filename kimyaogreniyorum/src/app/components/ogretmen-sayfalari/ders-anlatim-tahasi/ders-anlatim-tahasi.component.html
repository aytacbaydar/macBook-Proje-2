<div
  #toolbarRoot
  class="pdf-toolbar"
  [class.pdf-toolbar--dragging]="toolbarDrag.active"
  [class.pdf-toolbar--collapsed]="toolbarCollapsed"
  [style.top.px]="toolbarPosition.top"
  [style.left.px]="toolbarPosition.left"
>
  <div class="pdf-toolbar__drag-handle" (pointerdown)="onToolbarDragStart($event)">
    <div class="pdf-toolbar__handle-grip">
      <i class="bi bi-grip-vertical"></i>
    </div>
    <div class="pdf-toolbar__handle-actions">
      <span class="pdf-toolbar__handle-title">Araçlar</span>
      <button
        type="button"
        class="pdf-toolbar__collapse-btn"
        (click)="toggleToolbarCollapsed()"
        (pointerdown)="$event.stopPropagation()"
        [attr.aria-label]="toolbarCollapsed ? 'Paneli genişlet' : 'Paneli daralt'"
      >
        <i class="bi" [ngClass]="toolbarCollapsed ? 'bi-arrows-angle-expand' : 'bi-dash-lg'"></i>
      </button>
    </div>
  </div>

  <div class="pdf-toolbar__content" *ngIf="!toolbarCollapsed">
    <nav class="pdf-toolbar__nav" aria-label="Araç sekmeleri">
      <div class="toolbar-menu">
        <button
          type="button"
          class="toolbar-menu__toggle"
          (click)="toggleToolbarMenu($event)"
          [attr.aria-expanded]="toolbarMenuOpen"
        >
          <i class="bi bi-list"></i>
          <span class="toolbar-menu__label">{{ getActiveTabLabel() }}</span>
          <i class="bi" [ngClass]="toolbarMenuOpen ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
        </button>
        <div class="toolbar-menu__dropdown" *ngIf="toolbarMenuOpen">
          <button
            type="button"
            class="toolbar-menu__item toolbar-tab"
            *ngFor="let tab of toolbarTabs"
            (click)="selectToolbarTab(tab.id, $event)"
            [class.aktif]="isActiveTab(tab.id)"
          >
            <span>{{ tab.label }}</span>
            <i class="bi bi-check-lg" *ngIf="isActiveTab(tab.id)"></i>
          </button>
        </div>
      </div>
    </nav>

    <header class="pdf-toolbar__panel" aria-live="polite">
        <ng-container [ngSwitch]="activeToolbarTab">
          <ng-container *ngSwitchCase="'dosya'">
            <div class="pdf-toolbar__group">
              <button
                type="button"
                class="btn-ikonlu"
                title="Sayfa Ekle"
                (click)="yeniSayfaEkle()"
                [disabled]="!isBlankDocument || exportInProgress"
              >
                <i class="bi bi-file-earmark-plus" aria-hidden="true"></i>
                <span class="sr-only">Sayfa Ekle</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                title="PDF Ekle"
                (click)="pdfUploadInput.click()"
                [disabled]="pdfYukleniyor"
              >
                <i class="bi bi-file-earmark-arrow-up" aria-hidden="true"></i>
                <span class="sr-only">PDF Ekle</span>
              </button>
              <input
                #pdfUploadInput
                type="file"
                accept="application/pdf"
                (change)="onPdfSec($event)"
                hidden
              >
              <button
                type="button"
                class="btn-ikonlu"
                title="Fotoğraf Ekle"
                (click)="triggerImageUpload()"
                [disabled]="pdfYukleniyor"
              >
                <i class="bi bi-image" aria-hidden="true"></i>
                <span class="sr-only">Fotoğraf Ekle</span>
              </button>
              <input
                #imageUploadInput
                type="file"
                accept="image/*"
                (change)="onImageSelected($event)"
                hidden
              >
            </div>
          </ng-container>
          <ng-container *ngSwitchCase="'kaydet'">
            <div class="kaydet-panel">
              <div
                class="kaydet-panel__nav"
                role="tablist"
                aria-label="Kaydet seçenekleri"
              >
                <button
                  type="button"
                  class="kaydet-panel__tab"
                  (click)="setKaydetPanelMode('lesson')"
                  [class.aktif]="kaydetPanelMode === 'lesson'"
                  [attr.aria-pressed]="kaydetPanelMode === 'lesson'"
                >
                  <span>Ders Kaydi</span>
                </button>
                <button
                  type="button"
                  class="kaydet-panel__tab"
                  (click)="setKaydetPanelMode('attendance')"
                  [class.aktif]="kaydetPanelMode === 'attendance'"
                  [attr.aria-pressed]="kaydetPanelMode === 'attendance'"
                >
                  <span>Devams&#305;zl&#305;k</span>
                </button>
              </div>
    
              <div class="kaydet-panel__content" *ngIf="kaydetPanelMode === 'lesson'">
                <div class="toolbar-form">
                  <div class="toolbar-field">
                    <label class="toolbar-label" for="kaydetGrup">Grup</label>
                    <select
                      id="kaydetGrup"
                      class="toolbar-select"
                      [(ngModel)]="secilenGrup"
                      [ngModelOptions]="{ standalone: true }"
                      [disabled]="ogrenciGruplariYukleniyor"
                      (ngModelChange)="onGrupChange()"
                    >
                      <option value="">Grup seçin</option>
                      <option *ngFor="let grup of ogrenciGruplari" [value]="grup">{{ grup }}</option>
                    </select>
                  </div>
    
                  <div class="toolbar-field">
                    <label class="toolbar-label" for="kaydetKonu">Konu</label>
                    <select
                      id="kaydetKonu"
                      class="toolbar-select"
                      [(ngModel)]="secilenKonu"
                      (ngModelChange)="onKonuChange($event)"
                      [disabled]="konularYukleniyor || !konuBasliklari.length"
                      [ngModelOptions]="{ standalone: true }"
                    >
                      <option value="">Konu seçin</option>
                      <option *ngFor="let konu of konuBasliklari" [value]="konu">{{ konu }}</option>
                    </select>
                  </div>
    
                  <div class="toolbar-field">
                    <label class="toolbar-label" for="kaydetAltKonu">Alt konu / kazanım</label>
                    <select
                      id="kaydetAltKonu"
                      class="toolbar-select"
                      [(ngModel)]="secilenAltKonu"
                      [disabled]="!altKonuSecenekleri.length"
                      [ngModelOptions]="{ standalone: true }"
                      (ngModelChange)="onAltKonuChange()"
                    >
                      <option value="">Alt konu seçin</option>
                      <option *ngFor="let alt of altKonuSecenekleri" [value]="alt">{{ alt }}</option>
                    </select>
                  </div>
    
                  <button
                    type="button"
                    class="btn-ikonlu btn-primary"
                    title="Kaydet"
                    (click)="saveLessonRecord()"
                    [disabled]="lessonSaveInProgress || pdfYukleniyor || exportInProgress || !canSaveLesson"
                  >
                    <i class="bi" [ngClass]="lessonSaveInProgress ? 'bi-arrow-repeat spin' : 'bi-save'" aria-hidden="true"></i>
                    <span class="sr-only">{{ lessonSaveInProgress ? 'Kaydediliyor...' : 'Kaydet' }}</span>
                  </button>

                  <button
                    type="button"
                    class="btn-ikonlu"
                    title="PDF indir"
                    (click)="downloadPdf()"
                    [disabled]="pdfYukleniyor || exportInProgress"
                  >
                    <i class="bi bi-download" aria-hidden="true"></i>
                    <span class="sr-only">PDF indir</span>
                  </button>
                </div>
    
                <div class="toolbar-status" *ngIf="ogrenciGruplariYukleniyor || konularYukleniyor">
                  <span *ngIf="ogrenciGruplariYukleniyor">Gruplar yükleniyor...</span>
                  <span *ngIf="konularYukleniyor">Konular yükleniyor...</span>
                </div>
                <div class="toolbar-status toolbar-status--error" *ngIf="konularHataMesaji && !konularYukleniyor">
                  {{ konularHataMesaji }}
                </div>
                <div class="toolbar-status toolbar-status--error" *ngIf="kaydetErrorMessage">
                  {{ kaydetErrorMessage }}
                </div>
                <div class="toolbar-status toolbar-status--success" *ngIf="kaydetSuccessMessage">
                  {{ kaydetSuccessMessage }}
                </div>
              </div>
    
              <div class="kaydet-panel__content" *ngIf="kaydetPanelMode === 'attendance'">
                <div class="kaydet-attendance-intro">
                  <p class="kaydet-attendance-intro__text">
                    Devams&#305;zl&#305;k kay&#305;tlar&#305; daha geni&#351; bir modal pencere i&#231;inde a&#231;&#305;l&#305;r.
                  </p>
                  <button
                    type="button"
                    class="btn-attendance-open"
                    (click)="openAttendanceModal()"
                    [disabled]="attendanceModalOpen"
                  >
                    <i class="bi bi-clipboard-check" aria-hidden="true"></i>
                    <span>Devams&#305;zl&#305;k panelini a&#231;</span>
                  </button>
                </div>
              </div>
            </div>
          </ng-container>
    
                                    <ng-container *ngSwitchCase="'duzenle'">
            <div class="pdf-toolbar__group">
              <button
                type="button"
                class="btn-ikonlu"
                (click)="setTool('select')"
                [class.aktif]="currentTool === 'select'"
                title="Seç ve taşı"
              >
                <i class="bi bi-arrows-move" aria-hidden="true"></i>
                <span class="sr-only">Seç ve taşı</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="duplicateSelection()"
                [disabled]="!hasSelection || currentTool !== 'select'"
                title="Kopyala"
              >
                <i class="bi bi-copy" aria-hidden="true"></i>
                <span class="sr-only">Kopyala</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="pasteSelection()"
                [disabled]="!clipboardObject"
                title="Yapıştır"
              >
                <i class="bi bi-clipboard2-plus" aria-hidden="true"></i>
                <span class="sr-only">Yapıştır</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="cutSelection()"
                [disabled]="!hasSelection || currentTool !== 'select'"
                title="Kes"
              >
                <i class="bi bi-scissors" aria-hidden="true"></i>
                <span class="sr-only">Kes</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="deleteSelection()"
                [disabled]="!hasSelection || currentTool !== 'select'"
                title="Sil"
              >
                <i class="bi bi-trash3" aria-hidden="true"></i>
                <span class="sr-only">Sil</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="startCrop()"
                [disabled]="!hasSelection || isCropping"
                title="Kırp"
              >
                <i class="bi bi-crop" aria-hidden="true"></i>
                <span class="sr-only">Kırp</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu btn-temizle"
                (click)="clearCurrentAnnotations()"
                [disabled]="!currentPage"
                title="Temizle"
              >
                <i class="bi bi-eraser" aria-hidden="true"></i>
                <span class="sr-only">Temizle</span>
              </button>
            </div>

            <div class="pdf-toolbar__group pdf-toolbar__group--background">
              <span class="toolbar-label">Arka plan</span>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="setBackground('plain')"
                [class.aktif]="backgroundMode === 'plain'"
                [disabled]="!isBlankDocument"
                title="Düz"
              >
                <i class="bi bi-square" aria-hidden="true"></i>
                <span class="sr-only">Düz</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="setBackground('grid')"
                [class.aktif]="backgroundMode === 'grid'"
                [disabled]="!isBlankDocument"
                title="Kareli"
              >
                <i class="bi bi-grid-3x3-gap" aria-hidden="true"></i>
                <span class="sr-only">Kareli</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="setBackground('lined')"
                [class.aktif]="backgroundMode === 'lined'"
                [disabled]="!isBlankDocument"
                title="Çizgili"
              >
                <i class="bi bi-journal-text" aria-hidden="true"></i>
                <span class="sr-only">Çizgili</span>
              </button>
            </div>
          </ng-container>
          <ng-container *ngSwitchCase="'sekiller'">
            <div class="pdf-toolbar__group">
              <button type="button" class="btn-ikonlu" (click)="addShape('rectangle')" title="Dikdörtgen">
                <i class="bi bi-square" aria-hidden="true"></i>
                <span class="sr-only">Dikdörtgen</span>
              </button>
              <button type="button" class="btn-ikonlu" (click)="addShape('circle')" title="Daire">
                <i class="bi bi-circle" aria-hidden="true"></i>
                <span class="sr-only">Daire</span>
              </button>
              <button type="button" class="btn-ikonlu" (click)="addShape('triangle')" title="Üçgen">
                <i class="bi bi-triangle" aria-hidden="true"></i>
                <span class="sr-only">Üçgen</span>
              </button>
              <button type="button" class="btn-ikonlu" (click)="addArrow()" title="Ok">
                <i class="bi bi-arrow-up-right" aria-hidden="true"></i>
                <span class="sr-only">Ok</span>
              </button>
            </div>
          </ng-container>
          <ng-container *ngSwitchCase="'cizgiler'">
            <div class="pdf-toolbar__group">
              <button
                type="button"
                class="btn-ikonlu"
                (click)="setTool('pen')"
                [class.aktif]="currentTool === 'pen'"
                title="Kalem"
              >
                <i class="bi bi-pencil" aria-hidden="true"></i>
                <span class="sr-only">Kalem</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="setTool('highlighter')"
                [class.aktif]="currentTool === 'highlighter'"
                title="Vurgu kalemi"
              >
                <i class="bi bi-highlighter" aria-hidden="true"></i>
                <span class="sr-only">Vurgu kalemi</span>
              </button>
              <button
                type="button"
                class="btn-ikonlu"
                (click)="setTool('eraser')"
                [class.aktif]="currentTool === 'eraser'"
                title="Silgi"
              >
                <i class="bi bi-eraser-fill" aria-hidden="true"></i>
                <span class="sr-only">Silgi</span>
              </button>
            </div>

            <div class="pdf-toolbar__group">
              <span class="toolbar-label">Kalem rengi</span>
              <button
                type="button"
                class="renk-ikon-btn"
                *ngFor="let renk of penColorOptions"
                (click)="setPenColor(renk)"
                [style.backgroundColor]="renk"
                [class.aktif]="penColor === renk"
                [attr.aria-label]="'Kalem rengi ' + renk"
              ></button>
            </div>

            <div class="pdf-toolbar__group size-controls">
              <div class="size-control">
                <label class="toolbar-label" for="penSizeSelect">Kalem kalınlığı</label>
                <select
                  id="penSizeSelect"
                  class="size-select"
                  [ngModelOptions]="{ standalone: true }"
                  [(ngModel)]="penSize"
                  (ngModelChange)="onPenSizeChange($event)"
                >
                  <option *ngFor="let size of penSizeOptions" [value]="size">{{ size }} px</option>
                </select>
              </div>
              <div class="size-control">
                <label class="toolbar-label" for="eraserSizeSelect">Silgi boyutu</label>
                <select
                  id="eraserSizeSelect"
                  class="size-select"
                  [ngModelOptions]="{ standalone: true }"
                  [(ngModel)]="eraserSize"
                  (ngModelChange)="onEraserSizeChange($event)"
                >
                  <option *ngFor="let size of eraserSizeOptions" [value]="size">{{ size }} px</option>
                </select>
              </div>
            </div>
          </ng-container>

        </ng-container>
      </header>
  </div>
</div>


<div *ngIf="pdfYukleniyor" class="durum durum--ust">PDF yükleniyor...</div>
<div *ngIf="pdfHataMesaji" class="durum hata durum--ust">{{ pdfHataMesaji }}</div>

<div class="pdf-gorunumu" #pdfContainer>
  <canvas #pdfCanvas class="pdf-canvas" aria-label="PDF görünüm"></canvas>
  <canvas
    #annotationCanvas
    class="annotation-canvas"
    aria-label="Çizim alanı"
  ></canvas>

  <div
    class="selection-menu"
    *ngIf="selectionMenu.visible"
    [style.left.px]="selectionMenu.left"
    [style.top.px]="selectionMenu.top"
  >
    <ng-container *ngIf="selectionMenu.showCropActions; else selectionActions">
      <button type="button" class="selection-menu__button primary" (click)="confirmCrop()">
        <i class="fa-solid fa-crop-simple"></i>
        <span>Kırpmayı Onayla</span>
      </button>
      <button type="button" class="selection-menu__button" (click)="cancelCrop()">
        <i class="fa-solid fa-xmark"></i>
        <span>İptal</span>
      </button>
    </ng-container>
    <ng-template #selectionActions>
      <button
        type="button"
        class="selection-menu__button"
        (click)="startCrop()"
        *ngIf="selectionMenu.showCrop"
      >
        <i class="fa-solid fa-crop-simple"></i>
        <span>Kırp</span>
      </button>
      <button type="button" class="selection-menu__button" (click)="duplicateSelection()">
        <i class="fa-solid fa-copy"></i>
        <span>Kopyala</span>
      </button>
      <button type="button" class="selection-menu__button" (click)="cutSelection()">
        <i class="fa-solid fa-copy"></i>
        <span>Kes</span>
      </button>
      <button type="button" class="selection-menu__button danger" (click)="deleteSelection()">
        <i class="fa-solid fa-copy"></i>
        <span>Sil</span>
      </button>
      <button
        type="button"
        class="selection-menu__button"
        *ngIf="selectionMenu.showPaste"
        (click)="pasteSelection()"
      >
        <i class="fa-solid fa-clipboard"></i>
        <span>Yapıştır</span>
      </button>
    </ng-template>
  </div>
</div>

<div *ngIf="totalPages > 0" class="pdf-sayfa-alt-kontrol">
    <button type="button" (click)="ilkSayfa()" [disabled]="currentPage <= 1 || pdfYukleniyor">İlk</button>
    <button type="button" (click)="oncekiSayfa()" [disabled]="currentPage <= 1 || pdfYukleniyor">Önceki</button>
  <span>Sayfa {{ currentPage }} / {{ totalPages }}</span>
  <button type="button" (click)="sonrakiSayfa()" [disabled]="currentPage >= totalPages || pdfYukleniyor">
    Sonraki
  </button>
  <button type="button" (click)="sonSayfa()" [disabled]="currentPage >= totalPages || pdfYukleniyor">Son</button>
</div>






<div
  class="attendance-modal-backdrop"
  *ngIf="attendanceModalOpen"
  (click)="closeAttendanceModal()"
>
  <div
    class="attendance-modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="attendanceModalTitle"
    (click)="$event.stopPropagation()"
  >
    <header class="attendance-modal__header">
      <h2 id="attendanceModalTitle">Devams&#305;zl&#305;k Paneli</h2>
      <button
        type="button"
        class="attendance-modal__close"
        (click)="closeAttendanceModal()"
      >
        <i class="bi bi-x-lg" aria-hidden="true"></i>
        <span class="sr-only">Devams&#305;zl&#305;k panelini kapat</span>
      </button>
    </header>
    <div class="attendance-modal__body">
      <app-ogretmen-devamsizlik-sayfasi></app-ogretmen-devamsizlik-sayfasi>
    </div>
  </div>
</div>


















